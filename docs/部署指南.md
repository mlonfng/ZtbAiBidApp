# ZtbAi éƒ¨ç½²æŒ‡å—

## ğŸ“‹ æ¦‚è¿°

æœ¬æŒ‡å—è¯¦ç»†ä»‹ç»ZtbAiæŠ•æ ‡æ–‡ä»¶AIæ™ºèƒ½ç¼–è¾‘ç³»ç»Ÿçš„éƒ¨ç½²æ–¹æ³•ï¼ŒåŒ…æ‹¬å¼€å‘ç¯å¢ƒã€ç”Ÿäº§ç¯å¢ƒå’ŒDockerå®¹å™¨åŒ–éƒ¨ç½²ã€‚

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   å‰ç«¯åº”ç”¨       â”‚    â”‚   åç«¯APIæœåŠ¡    â”‚    â”‚   AIæœåŠ¡æä¾›å•†   â”‚
â”‚  React + TS     â”‚â—„â”€â”€â–ºâ”‚  FastAPI + Pythonâ”‚â—„â”€â”€â–ºâ”‚  OpenAI/Claude  â”‚
â”‚  Port: 3000     â”‚    â”‚  Port: 9958     â”‚    â”‚                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                       â”‚                       
         â–¼                       â–¼                       
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              
â”‚   é™æ€æ–‡ä»¶       â”‚    â”‚   SQLiteæ•°æ®åº“   â”‚              
â”‚   Buildè¾“å‡º     â”‚    â”‚   é¡¹ç›®æ•°æ®å­˜å‚¨   â”‚              
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              
```

## ğŸ”§ ç¯å¢ƒè¦æ±‚

### åŸºç¡€è¦æ±‚
- **æ“ä½œç³»ç»Ÿ**: Windows 10+, macOS 10.14+, Ubuntu 18.04+
- **Python**: 3.8+ (æ¨è3.9+)
- **Node.js**: 16.0+ (æ¨è18.0+)
- **å†…å­˜**: æœ€ä½4GBï¼Œæ¨è8GB+
- **å­˜å‚¨**: æœ€ä½10GBå¯ç”¨ç©ºé—´

### å¯é€‰è¦æ±‚
- **Docker**: 20.0+ (å®¹å™¨åŒ–éƒ¨ç½²)
- **Nginx**: 1.18+ (åå‘ä»£ç†)
- **SSLè¯ä¹¦**: HTTPSéƒ¨ç½²

## ğŸš€ å¼€å‘ç¯å¢ƒéƒ¨ç½²

### 1. å…‹éš†é¡¹ç›®
```bash
git clone <repository-url>
cd ZtbAiBidApp_202507210900
```

### 2. åç«¯ç¯å¢ƒè®¾ç½®
```bash
cd backend

# åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ (æ¨è)
python -m venv venv
source venv/bin/activate  # Linux/macOS
# æˆ–
venv\Scripts\activate     # Windows

# å®‰è£…ä¾èµ–
pip install -r requirements.txt

# é…ç½®AIæœåŠ¡ (å¯é€‰)
cp ztbai_config.json.example ztbai_config.json
# ç¼–è¾‘é…ç½®æ–‡ä»¶ï¼Œæ·»åŠ AI APIå¯†é’¥
```

### 3. å‰ç«¯ç¯å¢ƒè®¾ç½®
```bash
cd frontend

# å®‰è£…ä¾èµ–
npm install

# æˆ–ä½¿ç”¨yarn
yarn install
```

### 4. å¯åŠ¨å¼€å‘æœåŠ¡

**å¯åŠ¨åç«¯**:
```bash
cd backend
python new_api_server.py
```
âœ… åç«¯æœåŠ¡: http://localhost:9958

**å¯åŠ¨å‰ç«¯**:
```bash
cd frontend
npm start
```
âœ… å‰ç«¯åº”ç”¨: http://localhost:3000

### 5. éªŒè¯éƒ¨ç½²
```bash
# å¥åº·æ£€æŸ¥
curl http://localhost:9958/health

# è¿è¡Œæµ‹è¯•
cd backend
python tests/simple_e2e_test.py
```

## ğŸ­ ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²

### 1. æœåŠ¡å™¨å‡†å¤‡
```bash
# æ›´æ–°ç³»ç»Ÿ
sudo apt update && sudo apt upgrade -y

# å®‰è£…åŸºç¡€è½¯ä»¶
sudo apt install -y python3 python3-pip nodejs npm nginx git

# å®‰è£…PM2 (è¿›ç¨‹ç®¡ç†)
sudo npm install -g pm2
```

### 2. é¡¹ç›®éƒ¨ç½²
```bash
# å…‹éš†é¡¹ç›®åˆ°ç”Ÿäº§ç›®å½•
sudo mkdir -p /opt/ztbai
sudo chown $USER:$USER /opt/ztbai
cd /opt/ztbai
git clone <repository-url> .

# åç«¯éƒ¨ç½²
cd backend
python3 -m venv venv
source venv/bin/activate
pip install -r requirements.txt

# å‰ç«¯æ„å»º
cd ../frontend
npm install
npm run build
```

### 3. é…ç½®æ–‡ä»¶è®¾ç½®
```bash
# åç«¯é…ç½®
cd /opt/ztbai/backend
cp ztbai_config.json.example ztbai_config.json
# ç¼–è¾‘é…ç½®æ–‡ä»¶ï¼Œè®¾ç½®ç”Ÿäº§ç¯å¢ƒå‚æ•°

# åˆ›å»ºæ—¥å¿—ç›®å½•
mkdir -p logs
```

### 4. è¿›ç¨‹ç®¡ç†é…ç½®
åˆ›å»º `ecosystem.config.js`:
```javascript
module.exports = {
  apps: [{
    name: 'ztbai-backend',
    script: 'new_api_server.py',
    cwd: '/opt/ztbai/backend',
    interpreter: '/opt/ztbai/backend/venv/bin/python',
    instances: 1,
    autorestart: true,
    watch: false,
    max_memory_restart: '1G',
    env: {
      NODE_ENV: 'production',
      PORT: 9958
    },
    error_file: '/opt/ztbai/backend/logs/error.log',
    out_file: '/opt/ztbai/backend/logs/out.log',
    log_file: '/opt/ztbai/backend/logs/combined.log'
  }]
};
```

### 5. Nginxé…ç½®
åˆ›å»º `/etc/nginx/sites-available/ztbai`:
```nginx
server {
    listen 80;
    server_name your-domain.com;
    
    # å‰ç«¯é™æ€æ–‡ä»¶
    location / {
        root /opt/ztbai/frontend/build;
        index index.html index.htm;
        try_files $uri $uri/ /index.html;
    }
    
    # APIä»£ç†
    location /api/ {
        proxy_pass http://127.0.0.1:9958;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_cache_bypass $http_upgrade;
        proxy_read_timeout 300s;
        proxy_connect_timeout 75s;
    }
    
    # å¥åº·æ£€æŸ¥
    location /health {
        proxy_pass http://127.0.0.1:9958;
    }
    
    # é™æ€èµ„æºç¼“å­˜
    location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg)$ {
        expires 1y;
        add_header Cache-Control "public, immutable";
    }
}
```

### 6. å¯åŠ¨æœåŠ¡
```bash
# å¯ç”¨Nginxé…ç½®
sudo ln -s /etc/nginx/sites-available/ztbai /etc/nginx/sites-enabled/
sudo nginx -t
sudo systemctl reload nginx

# å¯åŠ¨åç«¯æœåŠ¡
cd /opt/ztbai
pm2 start ecosystem.config.js
pm2 save
pm2 startup
```

## ğŸ³ Dockeréƒ¨ç½²

### 1. åˆ›å»ºDockerfile
```dockerfile
# å¤šé˜¶æ®µæ„å»º
FROM node:18-alpine AS frontend-builder
WORKDIR /app/frontend
COPY frontend/package*.json ./
RUN npm ci --only=production
COPY frontend/ ./
RUN npm run build

FROM python:3.9-slim AS backend
WORKDIR /app
COPY backend/requirements.txt ./
RUN pip install --no-cache-dir -r requirements.txt
COPY backend/ ./
COPY --from=frontend-builder /app/frontend/build ./static

EXPOSE 9958
CMD ["python", "new_api_server.py"]
```

### 2. åˆ›å»ºdocker-compose.yml
```yaml
version: '3.8'

services:
  ztbai:
    build: .
    ports:
      - "9958:9958"
    volumes:
      - ./data:/app/data
      - ./logs:/app/logs
      - ./config:/app/config
    environment:
      - NODE_ENV=production
      - PYTHONPATH=/app
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:9958/health"]
      interval: 30s
      timeout: 10s
      retries: 3

  nginx:
    image: nginx:alpine
    ports:
      - "80:80"
      - "443:443"
    volumes:
      - ./nginx.conf:/etc/nginx/nginx.conf
      - ./ssl:/etc/nginx/ssl
    depends_on:
      - ztbai
    restart: unless-stopped
```

### 3. éƒ¨ç½²å‘½ä»¤
```bash
# æ„å»ºå’Œå¯åŠ¨
docker-compose up -d

# æŸ¥çœ‹æ—¥å¿—
docker-compose logs -f

# åœæ­¢æœåŠ¡
docker-compose down

# æ›´æ–°éƒ¨ç½²
docker-compose pull
docker-compose up -d --force-recreate
```

## ğŸ”’ å®‰å…¨é…ç½®

### 1. é˜²ç«å¢™è®¾ç½®
```bash
# Ubuntu/Debian
sudo ufw allow 22/tcp
sudo ufw allow 80/tcp
sudo ufw allow 443/tcp
sudo ufw enable

# CentOS/RHEL
sudo firewall-cmd --permanent --add-service=ssh
sudo firewall-cmd --permanent --add-service=http
sudo firewall-cmd --permanent --add-service=https
sudo firewall-cmd --reload
```

### 2. SSLè¯ä¹¦é…ç½®
```bash
# ä½¿ç”¨Let's Encrypt
sudo apt install certbot python3-certbot-nginx
sudo certbot --nginx -d your-domain.com

# è‡ªåŠ¨ç»­æœŸ
sudo crontab -e
# æ·»åŠ : 0 12 * * * /usr/bin/certbot renew --quiet
```

### 3. ç¯å¢ƒå˜é‡å®‰å…¨
```bash
# åˆ›å»ºç¯å¢ƒå˜é‡æ–‡ä»¶
cat > /opt/ztbai/.env << EOF
AI_API_KEY=your-secret-key
DATABASE_URL=sqlite:///data/ztbai.db
SECRET_KEY=your-secret-key
DEBUG=false
EOF

# è®¾ç½®æƒé™
chmod 600 /opt/ztbai/.env
```

## ğŸ“Š ç›‘æ§å’Œç»´æŠ¤

### 1. æ—¥å¿—ç®¡ç†
```bash
# æ—¥å¿—è½®è½¬é…ç½®
sudo cat > /etc/logrotate.d/ztbai << EOF
/opt/ztbai/backend/logs/*.log {
    daily
    missingok
    rotate 30
    compress
    delaycompress
    notifempty
    create 644 ztbai ztbai
    postrotate
        pm2 reload ztbai-backend
    endscript
}
EOF
```

### 2. æ€§èƒ½ç›‘æ§
```bash
# å®‰è£…ç›‘æ§å·¥å…·
npm install -g pm2-logrotate
pm2 install pm2-server-monit

# æŸ¥çœ‹æ€§èƒ½
pm2 monit
pm2 status
```

### 3. å¤‡ä»½ç­–ç•¥
```bash
#!/bin/bash
# backup.sh
DATE=$(date +%Y%m%d_%H%M%S)
BACKUP_DIR="/backup/ztbai"

# åˆ›å»ºå¤‡ä»½ç›®å½•
mkdir -p $BACKUP_DIR

# å¤‡ä»½æ•°æ®åº“
cp /opt/ztbai/backend/ztbai.db $BACKUP_DIR/ztbai_$DATE.db

# å¤‡ä»½é…ç½®æ–‡ä»¶
tar -czf $BACKUP_DIR/config_$DATE.tar.gz /opt/ztbai/backend/ztbai_config.json

# æ¸…ç†æ—§å¤‡ä»½ (ä¿ç•™30å¤©)
find $BACKUP_DIR -name "*.db" -mtime +30 -delete
find $BACKUP_DIR -name "*.tar.gz" -mtime +30 -delete
```

## ğŸš¨ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

#### 1. ç«¯å£å ç”¨
```bash
# æŸ¥çœ‹ç«¯å£å ç”¨
sudo netstat -tlnp | grep :9958
sudo lsof -i :9958

# æ€æ­»è¿›ç¨‹
sudo kill -9 <PID>
```

#### 2. æƒé™é—®é¢˜
```bash
# ä¿®å¤æ–‡ä»¶æƒé™
sudo chown -R ztbai:ztbai /opt/ztbai
sudo chmod -R 755 /opt/ztbai
```

#### 3. ä¾èµ–é—®é¢˜
```bash
# é‡æ–°å®‰è£…ä¾èµ–
cd /opt/ztbai/backend
pip install --upgrade -r requirements.txt

cd /opt/ztbai/frontend
npm install --force
```

#### 4. æ•°æ®åº“é—®é¢˜
```bash
# æ£€æŸ¥æ•°æ®åº“
sqlite3 /opt/ztbai/backend/ztbai.db ".tables"

# é‡å»ºæ•°æ®åº“
rm /opt/ztbai/backend/ztbai.db
# é‡å¯æœåŠ¡ï¼Œæ•°æ®åº“ä¼šè‡ªåŠ¨é‡å»º
```

### æ€§èƒ½ä¼˜åŒ–

#### 1. ç³»ç»Ÿä¼˜åŒ–
```bash
# å¢åŠ æ–‡ä»¶æè¿°ç¬¦é™åˆ¶
echo "* soft nofile 65536" >> /etc/security/limits.conf
echo "* hard nofile 65536" >> /etc/security/limits.conf

# ä¼˜åŒ–å†…æ ¸å‚æ•°
echo "net.core.somaxconn = 65536" >> /etc/sysctl.conf
sysctl -p
```

#### 2. åº”ç”¨ä¼˜åŒ–
- å¯ç”¨Gzipå‹ç¼©
- é…ç½®é™æ€æ–‡ä»¶ç¼“å­˜
- ä½¿ç”¨CDNåŠ é€Ÿ
- æ•°æ®åº“æŸ¥è¯¢ä¼˜åŒ–

## ğŸ“ æ”¯æŒä¸ç»´æŠ¤

### è”ç³»æ–¹å¼
- **æŠ€æœ¯æ”¯æŒ**: æŸ¥çœ‹é¡¹ç›®æ–‡æ¡£
- **é—®é¢˜åé¦ˆ**: æäº¤GitHub Issue
- **åŠŸèƒ½å»ºè®®**: æäº¤Feature Request

### ç»´æŠ¤è®¡åˆ’
- **æ—¥å¸¸ç›‘æ§**: ç³»ç»ŸçŠ¶æ€ã€æ€§èƒ½æŒ‡æ ‡
- **å®šæœŸå¤‡ä»½**: æ•°æ®åº“ã€é…ç½®æ–‡ä»¶
- **å®‰å…¨æ›´æ–°**: ä¾èµ–åŒ…ã€ç³»ç»Ÿè¡¥ä¸
- **æ€§èƒ½ä¼˜åŒ–**: å®šæœŸæ€§èƒ½æµ‹è¯•å’Œä¼˜åŒ–

---

**æ–‡æ¡£ç‰ˆæœ¬**: v3.0  
**æœ€åæ›´æ–°**: 2025-01-17  
**ç»´æŠ¤å›¢é˜Ÿ**: ZtbAiå¼€å‘å›¢é˜Ÿ
