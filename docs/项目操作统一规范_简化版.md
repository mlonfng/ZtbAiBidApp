# ZtbAi投标助手 - 项目操作统一规范（简化版）

## 📋 文档概述

本文档是基于完整版规范的简化版本，专注于核心操作规范和关键原则，为AI助手和开发人员提供清晰的指导。

## 🏗️ 项目架构概览

### 核心组件
- **前端**: React + TypeScript，基于URL路由的项目定位
- **后端**: Python FastAPI，统一API响应格式
- **数据库**: SQLite，标准化的进度状态管理
- **工作流**: 7个核心步骤的线性流程

## 🎯 核心操作规范

### 1. 项目定位机制统一规范

#### 问题背景
- **历史问题**: 前端基于URL路由，后端基于环境变量，导致操作混乱
- **具体表现**: 用户操作项目A，后端实际处理项目B

#### 统一解决方案
- **核心原则**: 所有项目操作都基于URL路由参数作为唯一项目定位依据
- **前端标准**: 从`useParams()`获取项目ID，传递给所有API调用
- **后端标准**: 完全基于传递的项目ID参数，不依赖环境变量
- **环境变量**: 仅用于系统级配置，不用于项目定位

### 2. API通信标准

#### 统一响应格式
```json
{
    "success": true/false,
    "message": "操作描述",
    "data": {},
    "code": 200
}
```

#### 路由规范
- **前缀统一**: `/api/projects/{project_id}/step/{step_key}`
- **参数类型**: 项目ID统一使用字符串类型
- **单一定义**: 每个API端点只在一个地方定义

### 3. 项目进度状态管理

#### 数据库表结构
- **project_step_progress**: 记录每个步骤的状态和进度
- **状态值**: pending → in_progress → completed (或error)
- **进度范围**: 0-100的百分比

#### 状态更新规范
- **开始步骤**: 状态设为in_progress，进度设为0
- **完成步骤**: 状态设为completed，进度设为100
- **错误处理**: 状态设为error，记录错误信息

## 🔄 工作流步骤标准

### 步骤列表
1. **service-mode**: 服务模式选择
2. **bid-analysis**: 招标文件分析
3. **framework-generation**: 投标框架生成
4. **material-management**: 资料管理
5. **content-generation**: 内容生成
6. **file-formatting**: 文件格式化
7. **document-export**: 文档导出

### 每个步骤的标准实现
- **前端组件**: 使用`useStepProgress` Hook管理状态
- **API调用**: 统一的错误处理和响应格式
- **进度更新**: 操作完成后调用`markStepCompleted`
- **导航控制**: 完成后自动跳转到下一步

## 🔧 开发规范要点

### 1. 冲突预防原则
- **API路由**: 每个端点只在一个地方定义
- **参数类型**: 项目ID统一使用字符串类型
- **响应格式**: 使用标准的成功/错误响应结构
- **数据库访问**: 通过统一的Repository层

### 2. 错误处理标准
- **前端**: 统一的错误提示和日志记录
- **后端**: 标准的异常捕获和错误响应
- **用户反馈**: 清晰的错误信息和操作建议

### 3. 日志记录规范
- **格式**: `[步骤标识] 操作描述: 详细信息`
- **级别**: INFO(正常操作)、ERROR(错误)、DEBUG(调试)
- **内容**: 包含项目ID、步骤、时间戳等关键信息

## 📊 质量保证

### 1. 开发检查清单
- [ ] API路由在项目中唯一
- [ ] 参数类型与现有API一致
- [ ] 响应格式符合标准
- [ ] 错误处理完整
- [ ] 进度状态正确更新

### 2. 测试验证
- **功能测试**: 每个步骤的核心功能
- **集成测试**: 步骤间的数据传递
- **错误测试**: 异常情况的处理
- **一致性测试**: 前后端数据一致性

### 3. 性能监控
- **响应时间**: API调用的响应速度
- **错误率**: 操作失败的频率
- **用户体验**: 页面加载和交互流畅度

## 🚨 常见问题和解决方案

### 1. 项目定位不一致
- **症状**: 前端显示项目A，后端处理项目B
- **原因**: 使用了环境变量而非URL参数
- **解决**: 统一使用URL路由参数

### 2. API路由冲突
- **症状**: 404错误或参数类型错误
- **原因**: 多处定义相同路由或参数类型不一致
- **解决**: 检查并移除重复定义，统一参数类型

### 3. 进度状态异常
- **症状**: 步骤状态不更新或进度值异常
- **原因**: 数据库更新失败或逻辑错误
- **解决**: 检查数据库连接和更新逻辑

## 🎯 实施建议

### 1. 新功能开发
- 严格按照本规范进行设计和实现
- 使用标准的页面组件模板
- 集成统一的状态管理和错误处理

### 2. 现有功能重构
- 逐步将现有功能迁移到新规范
- 优先处理用户反馈的问题区域
- 保持向后兼容性

### 3. 团队协作
- 定期进行规范培训和分享
- 代码审查时严格检查规范遵循情况
- 建立问题反馈和改进机制

## 📝 总结

本规范确保了：
- **一致性**: 所有步骤遵循统一的实现模式
- **可维护性**: 清晰的代码结构和标准化接口
- **用户体验**: 流畅的操作流程和及时的反馈
- **开发效率**: 标准化的开发模板和工具

## ⚠️ 重要提醒

1. **项目定位**: 必须基于URL路由参数，禁止使用环境变量
2. **API设计**: 每个端点只在一个地方定义，避免冲突
3. **错误处理**: 使用统一的错误处理机制
4. **状态管理**: 及时更新步骤进度状态
5. **测试验证**: 每次修改都要进行完整测试

---

**文档版本**: v1.0 (简化版)  
**创建日期**: 2025-08-14  
**基于**: 项目操作统一规范.md v2.0  
**维护者**: ZtbAi开发团队
