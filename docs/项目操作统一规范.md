# ZtbAiæŠ•æ ‡åŠ©æ‰‹ - é¡¹ç›®æ“ä½œç»Ÿä¸€è§„èŒƒ

## ğŸ“‹ æ–‡æ¡£æ¦‚è¿°

æœ¬æ–‡æ¡£åŸºäºå¯¹æ•´ä¸ªé¡¹ç›®çš„æ·±å…¥åˆ†æï¼Œç‰¹åˆ«æ˜¯æœåŠ¡æ¨¡å¼é€‰æ‹©å’Œæ‹›æ ‡æ–‡ä»¶åˆ†æä¸¤ä¸ªæ ¸å¿ƒæ­¥éª¤çš„å®ç°ï¼Œåˆ¶å®šäº†ç»Ÿä¸€çš„æ“ä½œè§„èŒƒï¼Œç¡®ä¿åç»­æ­¥éª¤çš„å¼€å‘å’Œç»´æŠ¤éµå¾ªä¸€è‡´çš„æ¨¡å¼ï¼Œé¿å…å¼•èµ·æ··ä¹±å’Œé”™è¯¯ã€‚

## ğŸ—ï¸ é¡¹ç›®æ¶æ„æ¦‚è§ˆ

### æ ¸å¿ƒç»„ä»¶ç»“æ„
```
ZtbAiBidApp/
â”œâ”€â”€ frontend/                    # React + TypeScript å‰ç«¯
â”‚   â”œâ”€â”€ src/pages/              # é¡µé¢ç»„ä»¶
â”‚   â”œâ”€â”€ src/services/           # APIæœåŠ¡å±‚
â”‚   â”œâ”€â”€ src/store/              # ReduxçŠ¶æ€ç®¡ç†
â”‚   â”œâ”€â”€ src/hooks/              # è‡ªå®šä¹‰Hooks
â”‚   â””â”€â”€ src/components/         # é€šç”¨ç»„ä»¶
â”œâ”€â”€ backend/                     # Python FastAPI åç«¯
â”‚   â”œâ”€â”€ new_api_server.py       # ä¸»APIæœåŠ¡å™¨
â”‚   â”œâ”€â”€ app/services/           # ä¸šåŠ¡æœåŠ¡å±‚
â”‚   â”œâ”€â”€ app/api/                # APIè·¯ç”±
â”‚   â””â”€â”€ ztbai.db               # SQLiteæ•°æ®åº“
â””â”€â”€ é¡¹ç›®è¿›åº¦çŠ¶æ€é€»è¾‘.md          # è¿›åº¦ç®¡ç†æŠ€æœ¯æ–‡æ¡£
```

## ğŸ”„ ç»Ÿä¸€æ•°æ®æµè½¬æ¨¡å¼

### 1. æ ‡å‡†APIé€šä¿¡æ¨¡å¼

#### å‰ç«¯APIè°ƒç”¨æ ‡å‡†
```typescript
// ç»Ÿä¸€çš„APIåŸºç¡€é…ç½®
const API_BASE_URL = process.env.REACT_APP_API_BASE_URL || 'http://127.0.0.1:9958';

// æ ‡å‡†APIè°ƒç”¨æ¨¡å¼
export const stepAPI = {
  // è·å–æ­¥éª¤çŠ¶æ€
  getStepStatus: async (projectId: string, stepKey: string) => {
    const response = await fetch(`${API_BASE_URL}/api/projects/${projectId}/step/${stepKey}/status`);
    return response.json();
  },
  
  // æ‰§è¡Œæ­¥éª¤æ“ä½œ
  executeStep: async (projectId: string, stepKey: string, data: any) => {
    const response = await fetch(`${API_BASE_URL}/api/projects/${projectId}/step/${stepKey}/execute`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(data)
    });
    return response.json();
  },
  
  // è·å–æ­¥éª¤ç»“æœ
  getStepResult: async (projectId: string, stepKey: string) => {
    const response = await fetch(`${API_BASE_URL}/api/projects/${projectId}/step/${stepKey}/result`);
    return response.json();
  }
};
```

#### åç«¯APIå“åº”æ ‡å‡†
```python
# ç»Ÿä¸€å“åº”æ ¼å¼
{
    "success": True,
    "message": "æ“ä½œæˆåŠŸ",
    "data": {
        # å…·ä½“æ•°æ®
    },
    "timestamp": "2025-08-13T10:00:00Z"
}

# é”™è¯¯å“åº”æ ¼å¼
{
    "success": False,
    "message": "é”™è¯¯æè¿°",
    "error_code": "ERROR_CODE",
    "timestamp": "2025-08-13T10:00:00Z"
}
```

### 2. é¡¹ç›®è¿›åº¦çŠ¶æ€ç®¡ç†æ ‡å‡†

#### æ•°æ®åº“è¡¨ç»“æ„ï¼ˆå·²å®ç°ï¼‰
```sql
-- é¡¹ç›®æ­¥éª¤è¿›åº¦è¡¨
CREATE TABLE project_step_progress (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    project_id INTEGER NOT NULL,
    step_key VARCHAR(50) NOT NULL,           -- æ­¥éª¤æ ‡è¯†ç¬¦
    step_name VARCHAR(100) NOT NULL,         -- æ­¥éª¤æ˜¾ç¤ºåç§°
    status VARCHAR(20) DEFAULT 'pending',    -- pending/in_progress/completed/error
    progress REAL DEFAULT 0.0,              -- è¿›åº¦ç™¾åˆ†æ¯” (0-100)
    started_at DATETIME,                     -- å¼€å§‹æ—¶é—´
    completed_at DATETIME,                   -- å®Œæˆæ—¶é—´
    data TEXT,                               -- JSONæ ¼å¼æ‰©å±•æ•°æ®
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    UNIQUE(project_id, step_key)
);
```

#### çŠ¶æ€è½¬æ¢è§„åˆ™
```
pending â†’ in_progress â†’ completed
   â†“           â†“           â†“
 error â†â”€â”€â”€ error â†â”€â”€â”€ error
```

### 3. å‰ç«¯çŠ¶æ€ç®¡ç†æ ‡å‡†

#### Redux Slice æ ‡å‡†ç»“æ„
```typescript
// æ¯ä¸ªæ­¥éª¤çš„çŠ¶æ€æ¥å£
interface StepState {
  loading: boolean;
  executing: boolean;
  completed: boolean;
  error: string | null;
  data: any;
  progress: number;
}

// å¼‚æ­¥æ“ä½œæ ‡å‡†æ¨¡å¼
export const executeStepAction = createAsyncThunk(
  'step/execute',
  async ({ projectId, stepKey, data }: ExecuteStepParams, { rejectWithValue }) => {
    try {
      const response = await stepAPI.executeStep(projectId, stepKey, data);
      if (!response.success) {
        throw new Error(response.message);
      }
      return response.data;
    } catch (error: any) {
      return rejectWithValue(error.message);
    }
  }
);
```

## ğŸ“ æ­¥éª¤å®ç°æ ‡å‡†æ¨¡æ¿

### 1. æœåŠ¡æ¨¡å¼é€‰æ‹©æ­¥éª¤åˆ†æ

#### å®ç°ç‰¹ç‚¹
- âœ… **çŠ¶æ€ç®¡ç†**: ä½¿ç”¨ `useStepProgress` Hook
- âœ… **APIé›†æˆ**: å®Œæ•´çš„æœåŠ¡æ¨¡å¼CRUDæ“ä½œ
- âœ… **è¿›åº¦æ›´æ–°**: é€‰æ‹©å®Œæˆåè‡ªåŠ¨æ›´æ–°æ­¥éª¤çŠ¶æ€
- âœ… **å¯¼èˆªæ§åˆ¶**: å®Œæˆåè‡ªåŠ¨è·³è½¬åˆ°ä¸‹ä¸€æ­¥

#### å…³é”®ä»£ç æ¨¡å¼
```typescript
// 1. Hookä½¿ç”¨
const { markStepCompleted, markStepInProgress } = useStepProgress(projectId || '', 'service-mode');

// 2. æ“ä½œå®Œæˆå¤„ç†
const handleApplyMode = async () => {
  const response = await serviceAPI.setServiceMode(selectedMode, projectId);
  if (response.success) {
    // æ›´æ–°æ­¥éª¤çŠ¶æ€
    await markStepCompleted({ currentMode: selectedMode });
    // å¯¼èˆªåˆ°ä¸‹ä¸€æ­¥
    navigate(`/projects/${projectId}/step/bid-analysis`);
  }
};
```

### 2. æ‹›æ ‡æ–‡ä»¶åˆ†ææ­¥éª¤åˆ†æ

#### å®ç°ç‰¹ç‚¹
- âœ… **å¼‚æ­¥ä»»åŠ¡ç®¡ç†**: æ”¯æŒé•¿æ—¶é—´è¿è¡Œçš„åˆ†æä»»åŠ¡
- âœ… **è¿›åº¦ç›‘æ§**: å®æ—¶æ˜¾ç¤ºåˆ†æè¿›åº¦
- âœ… **ç»“æœå±•ç¤º**: ç»“æ„åŒ–å±•ç¤ºåˆ†æç»“æœ
- âœ… **çŠ¶æ€æŒä¹…åŒ–**: åˆ†æå®Œæˆåä¿å­˜ç»“æœ

#### å…³é”®ä»£ç æ¨¡å¼
```typescript
// 1. å¼‚æ­¥ä»»åŠ¡å¯åŠ¨
const startAnalysis = async () => {
  setAnalyzing(true);
  markStepInProgress(0);
  
  const response = await analysisAPI.startAnalysis(projectId, analysisType);
  if (response.success) {
    setCurrentTaskId(response.data.task_id);
    monitorAnalysisProgress(response.data.task_id);
  }
};

// 2. è¿›åº¦ç›‘æ§
const monitorAnalysisProgress = async (taskId: string) => {
  const checkProgress = async () => {
    const response = await analysisAPI.getAnalysisStatus(taskId);
    if (response.data.status === 'completed') {
      setAnalysisResult(response.data.result);
      markStepCompleted('bid-analysis');
    } else {
      setTimeout(checkProgress, 2000); // ç»§ç»­ç›‘æ§
    }
  };
  checkProgress();
};
```

## ğŸ¯ åç»­æ­¥éª¤ç»Ÿä¸€å®ç°æ–¹æ¡ˆ

### 1. é¡µé¢ç»„ä»¶æ ‡å‡†ç»“æ„

```typescript
// æ ‡å‡†é¡µé¢ç»„ä»¶æ¨¡æ¿
const StepPage: React.FC = () => {
  const { projectId } = useParams<{ projectId: string }>();
  const [searchParams] = useSearchParams();
  const navigate = useNavigate();
  
  // ç»Ÿä¸€çš„é¡¹ç›®IDè·å–
  const actualProjectId = projectId || searchParams.get('projectId') || undefined;
  
  // ç»Ÿä¸€çš„æ­¥éª¤è¿›åº¦ç®¡ç†
  const { markStepCompleted, markStepInProgress, updating } = useStepProgress(
    actualProjectId || '', 
    'step-key'
  );
  
  // ç»Ÿä¸€çš„çŠ¶æ€ç®¡ç†
  const [loading, setLoading] = useState(true);
  const [executing, setExecuting] = useState(false);
  const [stepData, setStepData] = useState<any>(null);
  const [error, setError] = useState<string | null>(null);
  
  // ç»Ÿä¸€çš„æ•°æ®åŠ è½½
  useEffect(() => {
    if (actualProjectId) {
      loadStepData();
    }
  }, [actualProjectId]);
  
  const loadStepData = async () => {
    try {
      setLoading(true);
      const response = await stepAPI.getStepStatus(actualProjectId!, 'step-key');
      if (response.success) {
        setStepData(response.data);
      }
    } catch (error: any) {
      setError(error.message);
    } finally {
      setLoading(false);
    }
  };
  
  // ç»Ÿä¸€çš„æ­¥éª¤æ‰§è¡Œ
  const executeStep = async (data: any) => {
    try {
      setExecuting(true);
      markStepInProgress(0);
      
      const response = await stepAPI.executeStep(actualProjectId!, 'step-key', data);
      if (response.success) {
        setStepData(response.data);
        markStepCompleted(response.data);
        // å¯¼èˆªåˆ°ä¸‹ä¸€æ­¥
        navigate(`/projects/${actualProjectId}/step/next-step`);
      }
    } catch (error: any) {
      setError(error.message);
    } finally {
      setExecuting(false);
    }
  };
  
  return (
    <div>
      {/* ç»Ÿä¸€çš„é¡µé¢ç»“æ„ */}
      <ProjectStepNavigation
        projectId={actualProjectId}
        currentStep="step-key"
        canProceed={stepData?.completed || false}
        strictMode={true}
      />
    </div>
  );
};
```

### 2. åç«¯APIæ ‡å‡†ç»“æ„

```python
# æ ‡å‡†APIç«¯ç‚¹æ¨¡æ¿
@app.get("/api/projects/{project_id}/step/{step_key}/status")
async def get_step_status(project_id: str, step_key: str):
    """è·å–æ­¥éª¤çŠ¶æ€"""
    try:
        # éªŒè¯é¡¹ç›®å­˜åœ¨
        project = get_project_by_id(project_id)
        if not project:
            return create_error_response("é¡¹ç›®ä¸å­˜åœ¨", 404)
        
        # è·å–æ­¥éª¤çŠ¶æ€
        step_data = get_step_progress(project_id, step_key)
        
        return create_response(
            success=True,
            message="è·å–æ­¥éª¤çŠ¶æ€æˆåŠŸ",
            data=step_data
        )
    except Exception as e:
        return create_error_response(f"è·å–æ­¥éª¤çŠ¶æ€å¤±è´¥: {str(e)}")

@app.post("/api/projects/{project_id}/step/{step_key}/execute")
async def execute_step(project_id: str, step_key: str, request: Request):
    """æ‰§è¡Œæ­¥éª¤æ“ä½œ"""
    try:
        data = await request.json()
        
        # æ›´æ–°æ­¥éª¤çŠ¶æ€ä¸ºè¿›è¡Œä¸­
        update_step_progress(project_id, step_key, 'in_progress', 0)
        
        # æ‰§è¡Œå…·ä½“æ­¥éª¤é€»è¾‘
        result = await execute_step_logic(project_id, step_key, data)
        
        # æ›´æ–°æ­¥éª¤çŠ¶æ€ä¸ºå®Œæˆ
        update_step_progress(project_id, step_key, 'completed', 100, result)
        
        return create_response(
            success=True,
            message="æ­¥éª¤æ‰§è¡ŒæˆåŠŸ",
            data=result
        )
    except Exception as e:
        # æ›´æ–°æ­¥éª¤çŠ¶æ€ä¸ºé”™è¯¯
        update_step_progress(project_id, step_key, 'error', 0)
        return create_error_response(f"æ­¥éª¤æ‰§è¡Œå¤±è´¥: {str(e)}")
```

### 3. æ•°æ®åº“æ“ä½œæ ‡å‡†

```python
# ç»Ÿä¸€çš„æ­¥éª¤è¿›åº¦æ›´æ–°å‡½æ•°
def update_step_progress(project_id: str, step_key: str, status: str, 
                        progress: float = None, data: dict = None):
    """æ›´æ–°æ­¥éª¤è¿›åº¦çš„æ ‡å‡†å‡½æ•°"""
    try:
        with sqlite3.connect(DB_PATH) as conn:
            cursor = conn.cursor()
            
            # æ„å»ºæ›´æ–°è¯­å¥
            update_fields = ["status = ?", "updated_at = ?"]
            update_values = [status, datetime.now().isoformat()]
            
            if progress is not None:
                update_fields.append("progress = ?")
                update_values.append(progress)
            
            if status == 'in_progress' and progress == 0:
                update_fields.append("started_at = ?")
                update_values.append(datetime.now().isoformat())
            
            if status == 'completed':
                update_fields.append("completed_at = ?")
                update_values.append(datetime.now().isoformat())
            
            if data is not None:
                update_fields.append("data = ?")
                update_values.append(json.dumps(data))
            
            # æ‰§è¡Œæ›´æ–°
            sql = f"""
                INSERT OR REPLACE INTO project_step_progress
                (project_id, step_key, step_name, {', '.join(update_fields.replace(' = ?', ''))})
                VALUES (?, ?, ?, {', '.join(['?'] * len(update_values))})
            """
            
            cursor.execute(sql, [project_id, step_key, get_step_name(step_key)] + update_values)
            conn.commit()
            
            return True
    except Exception as e:
        logger.error(f"æ›´æ–°æ­¥éª¤è¿›åº¦å¤±è´¥: {e}")
        return False
```

## ğŸ”§ å¼€å‘è§„èŒƒå’Œæœ€ä½³å®è·µ

### 1. é¡¹ç›®å®šä½æœºåˆ¶ç»Ÿä¸€è§„èŒƒ

#### 1.1 é—®é¢˜èƒŒæ™¯

**å†å²é—®é¢˜**ï¼š
åœ¨2025å¹´8æœˆ14æ—¥çš„åˆ†æä¸­å‘ç°ï¼Œç³»ç»Ÿå­˜åœ¨åŒé‡é¡¹ç›®å®šä½æœºåˆ¶å¯¼è‡´çš„æ“ä½œæ··ä¹±ï¼š
- **å‰ç«¯**ï¼šåŸºäºURLè·¯ç”±å‚æ•°è·å–é¡¹ç›®ID
- **åç«¯**ï¼šåŸºäºç¯å¢ƒå˜é‡æ–‡ä»¶è·å–é¡¹ç›®ä¿¡æ¯
- **ç»“æœ**ï¼šç”¨æˆ·åœ¨å‰ç«¯æ“ä½œé¡¹ç›®Aï¼Œä½†åç«¯å®é™…å¤„ç†çš„æ˜¯é¡¹ç›®B

**å…·ä½“è¡¨ç°**ï¼š
```typescript
// å‰ç«¯ï¼šä»URLè·å–é¡¹ç›®ID
const { projectId } = useParams<{ projectId: string }>();  // ä¾‹å¦‚ï¼šé¡¹ç›®12

// åç«¯ï¼šä»ç¯å¢ƒå˜é‡è·å–é¡¹ç›®ä¿¡æ¯
const env_data = JSON.parse(fs.readFileSync('current_project_env.json'));
const current_project_id = env_data.current_project.project_id;  // ä¾‹å¦‚ï¼šé¡¹ç›®11

// ç»“æœï¼šå‰ç«¯æ˜¾ç¤ºé¡¹ç›®12ï¼Œåç«¯åˆ†æé¡¹ç›®11 - æ··ä¹±ï¼
```

#### 1.2 ç»Ÿä¸€è§£å†³æ–¹æ¡ˆ

**æ ¸å¿ƒåŸåˆ™**ï¼šæ‰€æœ‰é¡¹ç›®æ“ä½œéƒ½åŸºäº**URLè·¯ç”±å‚æ•°**ä½œä¸ºå”¯ä¸€çš„é¡¹ç›®å®šä½ä¾æ®ã€‚

**å®æ–½æ ‡å‡†**ï¼š

**å‰ç«¯æ ‡å‡†**ï¼š
```typescript
// âœ… æ­£ç¡®ï¼šç»Ÿä¸€çš„é¡¹ç›®IDè·å–æ–¹å¼
const StepPage: React.FC = () => {
  const { projectId: pathProjectId } = useParams<{ projectId: string }>();
  const [searchParams] = useSearchParams();

  // ä¼˜å…ˆä»è·¯å¾„å‚æ•°è·å–ï¼Œå¦‚æœæ²¡æœ‰åˆ™ä»æŸ¥è¯¢å‚æ•°è·å–
  const projectId = pathProjectId || searchParams.get('projectId') || undefined;

  // æ‰€æœ‰APIè°ƒç”¨éƒ½ä½¿ç”¨è¿™ä¸ªprojectId
  const response = await api.call(projectId, data);
};
```

**åç«¯æ ‡å‡†**ï¼š
```python
# âœ… æ­£ç¡®ï¼šå®Œå…¨åŸºäºä¼ é€’çš„é¡¹ç›®IDå‚æ•°
async def execute_analysis_task(task_id: str, project_id: str, analysis_type: str):
    """æ‰§è¡Œåˆ†æä»»åŠ¡ - ç»Ÿä¸€é¡¹ç›®å®šä½æœºåˆ¶"""

    # ç›´æ¥ä½¿ç”¨ä¼ é€’çš„é¡¹ç›®IDä»æ•°æ®åº“æŸ¥è¯¢é¡¹ç›®è·¯å¾„
    project_path = get_project_path_by_id(project_id)

    if not project_path:
        raise Exception(f"æœªæ‰¾åˆ°é¡¹ç›®IDä¸º {project_id} çš„é¡¹ç›®è·¯å¾„")

    # ç»§ç»­æ‰§è¡Œåˆ†æé€»è¾‘...
```

**æ•°æ®åº“æŸ¥è¯¢æ ‡å‡†**ï¼š
```python
def get_project_path_by_id(project_id: str) -> Optional[str]:
    """æ ¹æ®é¡¹ç›®IDè·å–é¡¹ç›®è·¯å¾„çš„æ ‡å‡†æ–¹æ³•"""
    try:
        with sqlite3.connect(DB_PATH) as conn:
            cursor = conn.cursor()
            cursor.execute(
                "SELECT project_path FROM projects WHERE id = ? AND is_deleted IS NULL",
                (project_id,)
            )
            result = cursor.fetchone()
            return result[0] if result else None
    except Exception as e:
        logger.error(f"æŸ¥è¯¢é¡¹ç›®è·¯å¾„å¤±è´¥: {e}")
        return None
```

#### 1.3 ç¯å¢ƒå˜é‡çš„æ–°è§’è‰²

**è°ƒæ•´åçš„ä½œç”¨èŒƒå›´**ï¼š
- âŒ **ä¸å†ç”¨äº**ï¼šé¡¹ç›®å®šä½å’Œä¸šåŠ¡é€»è¾‘
- âœ… **ä»…ç”¨äº**ï¼šç³»ç»Ÿçº§é…ç½®å’Œå¼€å‘ç¯å¢ƒè®¾ç½®

```json
// current_project_env.json - ä»…ç”¨äºå¼€å‘è°ƒè¯•
{
  "timestamp": "2025-08-14T17:10:00.000000",
  "development_settings": {
    "debug_mode": true,
    "log_level": "DEBUG",
    "default_analysis_type": "comprehensive"
  },
  "system_config": {
    "max_concurrent_tasks": 5,
    "task_timeout": 300,
    "cache_enabled": true
  }
}
```

#### 1.4 è¿ç§»æ£€æŸ¥æ¸…å•

**åç«¯APIæ£€æŸ¥**ï¼š
- [ ] æ‰€æœ‰é¡¹ç›®ç›¸å…³APIéƒ½é€šè¿‡å‚æ•°æ¥æ”¶é¡¹ç›®ID
- [ ] ç§»é™¤å¯¹ç¯å¢ƒå˜é‡ä¸­é¡¹ç›®IDçš„ä¾èµ–
- [ ] ç»Ÿä¸€ä½¿ç”¨`get_project_path_by_id(project_id)`æ–¹æ³•
- [ ] ç¡®ä¿é”™è¯¯ä¿¡æ¯åŒ…å«å…·ä½“çš„é¡¹ç›®ID

**å‰ç«¯ç»„ä»¶æ£€æŸ¥**ï¼š
- [ ] æ‰€æœ‰é¡µé¢ç»„ä»¶éƒ½ä»URLè·¯ç”±è·å–é¡¹ç›®ID
- [ ] APIè°ƒç”¨éƒ½ä¼ é€’æ­£ç¡®çš„é¡¹ç›®IDå‚æ•°
- [ ] é¡¹ç›®åˆ‡æ¢æ—¶URLæ­£ç¡®æ›´æ–°
- [ ] é”™è¯¯å¤„ç†åŒ…å«é¡¹ç›®IDä¿¡æ¯

**æ•°æ®ä¸€è‡´æ€§æ£€æŸ¥**ï¼š
- [ ] æ•°æ®åº“ä¸­é¡¹ç›®IDä¸å‰ç«¯URLå‚æ•°ä¸€è‡´
- [ ] é¡¹ç›®è·¯å¾„å­˜åœ¨ä¸”å¯è®¿é—®
- [ ] é¡¹ç›®çŠ¶æ€ä¸æ“ä½œæƒé™åŒ¹é…

#### 1.5 å®æ–½æ•ˆæœéªŒè¯

**éªŒè¯æ–¹æ³•**ï¼š
```bash
# 1. æ£€æŸ¥åç«¯æ˜¯å¦è¿˜ä¾èµ–ç¯å¢ƒå˜é‡
grep -r "current_project_env.json" backend/ | grep -v "# æ³¨é‡Š"
grep -r "CURRENT_PROJECT_ID" backend/ | grep -v "# æ³¨é‡Š"

# 2. æµ‹è¯•é¡¹ç›®åˆ‡æ¢ä¸€è‡´æ€§
curl -X POST "http://localhost:9958/api/analysis/start" \
  -H "Content-Type: application/json" \
  -d '{"project_id": "12", "analysis_type": "comprehensive"}'

# 3. éªŒè¯åˆ†æç»“æœä¿å­˜åˆ°æ­£ç¡®é¡¹ç›®
curl -X GET "http://localhost:9958/api/analysis/result/12"
```

**æˆåŠŸæ ‡å‡†**ï¼š
- âœ… å‰ç«¯æ˜¾ç¤ºçš„é¡¹ç›®IDä¸åç«¯å¤„ç†çš„é¡¹ç›®IDå®Œå…¨ä¸€è‡´
- âœ… åˆ†æç»“æœä¿å­˜åˆ°æ­£ç¡®çš„é¡¹ç›®ç›®å½•
- âœ… é¡¹ç›®åˆ‡æ¢æ—¶æ‰€æœ‰æ“ä½œéƒ½ä½œç”¨äºæ­£ç¡®çš„é¡¹ç›®
- âœ… é”™è¯¯ä¿¡æ¯æ˜ç¡®æŒ‡ç¤ºå…·ä½“çš„é¡¹ç›®ID

#### 1.6 é¢„é˜²æªæ–½

**å¼€å‘è§„èŒƒ**ï¼š
```python
# âŒ ç¦æ­¢ï¼šä»ç¯å¢ƒå˜é‡è·å–é¡¹ç›®ä¿¡æ¯ç”¨äºä¸šåŠ¡é€»è¾‘
def bad_example():
    project_id = os.environ.get('CURRENT_PROJECT_ID')  # ç¦æ­¢ï¼
    return process_project(project_id)

# âœ… æ­£ç¡®ï¼šæ‰€æœ‰é¡¹ç›®æ“ä½œéƒ½é€šè¿‡å‚æ•°ä¼ é€’
def good_example(project_id: str):
    if not project_id:
        raise ValueError("é¡¹ç›®IDä¸èƒ½ä¸ºç©º")
    return process_project(project_id)
```

**ä»£ç å®¡æŸ¥è¦ç‚¹**ï¼š
- [ ] æ–°å¢çš„é¡¹ç›®ç›¸å…³APIæ˜¯å¦é€šè¿‡å‚æ•°æ¥æ”¶é¡¹ç›®ID
- [ ] æ˜¯å¦å­˜åœ¨ä»ç¯å¢ƒå˜é‡è¯»å–é¡¹ç›®ä¿¡æ¯çš„ä»£ç 
- [ ] å‰ç«¯ç»„ä»¶æ˜¯å¦æ­£ç¡®ä»URLè·å–é¡¹ç›®ID
- [ ] é”™è¯¯å¤„ç†æ˜¯å¦åŒ…å«é¡¹ç›®IDä¸Šä¸‹æ–‡ä¿¡æ¯

### 2. APIè·¯ç”±ç®¡ç†è§„èŒƒ

#### 1.1 è·¯ç”±å†²çªé¢„é˜²åŸåˆ™

**é—®é¢˜èƒŒæ™¯**ï¼š
åœ¨é¡¹ç›®å¼€å‘è¿‡ç¨‹ä¸­å‘ç°äº†ä¸¥é‡çš„APIè·¯ç”±å†²çªé—®é¢˜ï¼š
- `backend/new_api_server.py` ä¸­ç›´æ¥å®šä¹‰äº†é¡¹ç›®ç›¸å…³API
- `backend/app/api/project.py` ä¸­ä¹Ÿå®šä¹‰äº†ç›¸åŒçš„APIè·¯ç”±
- å¯¼è‡´è·¯ç”±é‡å¤æ³¨å†Œã€å‚æ•°ç±»å‹å†²çªã€é”™è¯¯å¤„ç†ä¸ä¸€è‡´ç­‰é—®é¢˜

**è§£å†³åŸåˆ™**ï¼š

```python
# âŒ é”™è¯¯åšæ³•ï¼šå¤šå¤„å®šä¹‰ç›¸åŒAPI
# æ–‡ä»¶1: new_api_server.py
@app.get("/api/projects/{project_id}/progress")
async def get_project_progress(project_id: str):
    # å®ç°1

# æ–‡ä»¶2: app/api/project.py
@router.get("/{project_id}/progress")  # æ³¨å†Œåå˜æˆ /api/projects/{project_id}/progress
async def get_project_progress(project_id: int):  # å‚æ•°ç±»å‹ä¸ä¸€è‡´
    # å®ç°2 - å†²çªï¼
```

```python
# âœ… æ­£ç¡®åšæ³•ï¼šç»Ÿä¸€APIå®šä¹‰ä½ç½®
# æ–¹æ¡ˆA: ä½¿ç”¨æ¨¡å—åŒ–è·¯ç”±ï¼ˆæ¨èï¼‰
# app/api/project.py
router = APIRouter(prefix="/projects", tags=["projects"])

@router.get("/{project_id}/progress")
async def get_project_progress(project_id: str):  # ç»Ÿä¸€ä½¿ç”¨strç±»å‹
    """è·å–é¡¹ç›®è¿›å±•çŠ¶æ€"""
    # ç»Ÿä¸€å®ç°

# new_api_server.py
app.include_router(project_router, prefix="/api", tags=["é¡¹ç›®ç®¡ç†"])
```

#### 1.2 APIè·¯ç”±ç»„ç»‡è§„èŒƒ

**1. å•ä¸€èŒè´£åŸåˆ™**
```python
# æ¯ä¸ªAPIç«¯ç‚¹åªåœ¨ä¸€ä¸ªåœ°æ–¹å®šä¹‰
# é¿å…åœ¨å¤šä¸ªæ–‡ä»¶ä¸­é‡å¤å®šä¹‰ç›¸åŒè·¯ç”±
```

**2. è·¯å¾„å‰ç¼€è§„èŒƒ**
```python
# æ¨¡å—åŒ–è·¯ç”±æ–‡ä»¶ä¸­ä¸åŒ…å« /api å‰ç¼€
router = APIRouter(prefix="/projects", tags=["projects"])

# ä¸»æœåŠ¡å™¨æ³¨å†Œæ—¶æ·»åŠ  /api å‰ç¼€
app.include_router(project_router, prefix="/api")

# æœ€ç»ˆè·¯å¾„: /api/projects/{project_id}/progress
```

**3. å‚æ•°ç±»å‹ç»Ÿä¸€**
```python
# ç»Ÿä¸€ä½¿ç”¨å­—ç¬¦ä¸²ç±»å‹çš„é¡¹ç›®ID
async def api_function(project_id: str):  # âœ… ç»Ÿä¸€ä½¿ç”¨str
    # å†…éƒ¨è½¬æ¢ä¸ºéœ€è¦çš„ç±»å‹
    try:
        project_id_int = int(project_id) if project_id.isdigit() else None
    except ValueError:
        raise HTTPException(status_code=400, detail="æ— æ•ˆçš„é¡¹ç›®IDæ ¼å¼")
```

#### 1.3 è·¯ç”±å†²çªæ£€æµ‹å’Œè§£å†³

**æ£€æµ‹æ–¹æ³•**ï¼š
```bash
# 1. æœç´¢é‡å¤çš„è·¯ç”±å®šä¹‰
grep -r "@.*\.get.*projects.*progress" backend/
grep -r "projects/{project_id}" backend/

# 2. æ£€æŸ¥è·¯ç”±æ³¨å†Œ
grep -r "include_router" backend/
grep -r "@app\." backend/
```

**è§£å†³æ­¥éª¤**ï¼š
1. **è¯†åˆ«å†²çª**ï¼šæ‰¾å‡ºæ‰€æœ‰å®šä¹‰ç›¸åŒè·¯å¾„çš„API
2. **é€‰æ‹©ä¸»å®ç°**ï¼šç¡®å®šå“ªä¸ªå®ç°ä½œä¸ºæ ‡å‡†å®ç°
3. **è¿ç§»åŠŸèƒ½**ï¼šå°†å…¶ä»–å®ç°çš„åŠŸèƒ½åˆå¹¶åˆ°ä¸»å®ç°ä¸­
4. **ç§»é™¤é‡å¤**ï¼šåˆ é™¤æˆ–æ³¨é‡Šæ‰é‡å¤çš„APIå®šä¹‰
5. **æµ‹è¯•éªŒè¯**ï¼šç¡®ä¿APIåŠŸèƒ½æ­£å¸¸ä¸”æ— å†²çª

#### 1.3.1 å®Œæ•´è·¯ç”±å†²çªè§£å†³æ–¹æ¡ˆ

**å½“å‰é—®é¢˜åˆ†æ**ï¼š
- æ¨¡å—åŒ–APIè·¯ç”±ï¼ˆ`app/api/project.py`ï¼‰è¢«ç¦ç”¨ä½†å‰ç«¯ä»æŒ‰æ­¤è·¯å¾„è°ƒç”¨
- ä¸»æœåŠ¡å™¨ï¼ˆ`new_api_server.py`ï¼‰ä¸­æœ‰ç‹¬ç«‹å®ç°ä½†è·¯å¾„ä¸åŒ¹é…
- å‰ç«¯APIåŸºç¡€URLé…ç½®å¯¼è‡´åŒé‡å‰ç¼€é—®é¢˜

**æ ‡å‡†è§£å†³æ–¹æ¡ˆ**ï¼š

**æ–¹æ¡ˆAï¼šå¯ç”¨æ¨¡å—åŒ–è·¯ç”±ï¼ˆæ¨èï¼‰**
```python
# 1. åœ¨ new_api_server.py ä¸­å¯ç”¨æ¨¡å—åŒ–è·¯ç”±
try:
    from app.api.project import router as project_router
    app.include_router(project_router, prefix="/api", tags=["é¡¹ç›®ç®¡ç†"])
    print("âœ… å·²æ³¨å†Œæ¨¡å—åŒ–é¡¹ç›®APIè·¯ç”±")
except ImportError as e:
    print(f"âš ï¸ æ— æ³•å¯¼å…¥æ¨¡å—åŒ–é¡¹ç›®API: {e}")

# 2. ç§»é™¤ new_api_server.py ä¸­çš„é‡å¤APIå®ç°
# æ³¨é‡Šæˆ–åˆ é™¤æ‰€æœ‰ @app.get("/api/projects/...") å®šä¹‰

# 3. å‰ç«¯APIè°ƒç”¨ä¿æŒç›¸å¯¹è·¯å¾„
# baseURL: "http://127.0.0.1:9958/api"
# è°ƒç”¨è·¯å¾„: "/projects/{id}/config" -> æœ€ç»ˆ: "/api/projects/{id}/config"
```

**æ–¹æ¡ˆBï¼šç»Ÿä¸€åˆ°ä¸»æœåŠ¡å™¨ï¼ˆå¤‡é€‰ï¼‰**
```python
# 1. ä¿æŒæ¨¡å—åŒ–è·¯ç”±ç¦ç”¨çŠ¶æ€
# 2. ç¡®ä¿ new_api_server.py ä¸­æ‰€æœ‰é¡¹ç›®APIå®Œæ•´å®ç°
# 3. å‰ç«¯APIåŸºç¡€URLä¸åŒ…å« /api å‰ç¼€
# baseURL: "http://127.0.0.1:9958"
# è°ƒç”¨è·¯å¾„: "/api/projects/{id}/config"
```

**âš ï¸ æ–¹æ¡ˆAå®æ–½å¤±è´¥çš„ç»éªŒæ•™è®­**ï¼š
- æ¨¡å—åŒ–APIå­˜åœ¨å‚æ•°ç±»å‹ä¸ä¸€è‡´é—®é¢˜ï¼ˆint vs strï¼‰
- æœªç»å……åˆ†æµ‹è¯•å°±å¯ç”¨å¯¼è‡´ç³»ç»Ÿä¸ç¨³å®š
- å…¼å®¹æ€§æ£€æŸ¥ä¸å……åˆ†

**âœ… æ¨èé‡‡ç”¨æ–¹æ¡ˆBçš„åŸå› **ï¼š
- ä¸»æœåŠ¡å™¨å®ç°å·²éªŒè¯ç¨³å®šå¯é 
- ç¬¦åˆå‚æ•°ç±»å‹ç»Ÿä¸€è§„èŒƒï¼ˆproject_id: strï¼‰
- åŠŸèƒ½å®Œæ•´ï¼Œç»è¿‡å®é™…ä½¿ç”¨éªŒè¯
- é¿å…å¤æ‚çš„è¿ç§»é£é™©

#### 1.3.2 å®æ–½æ­¥éª¤è¯¦è§£

**æ­¥éª¤1ï¼šå†²çªæ£€æµ‹**
```bash
# æ£€æŸ¥å½“å‰è·¯ç”±å†²çª
grep -r "@app\.get.*projects" backend/new_api_server.py
grep -r "@router\.get.*projects" backend/app/api/project.py
```

**æ­¥éª¤2ï¼šé€‰æ‹©è§£å†³æ–¹æ¡ˆ**
- è¯„ä¼°æ¨¡å—åŒ–è·¯ç”±çš„å®Œæ•´æ€§
- æ£€æŸ¥ä¸»æœåŠ¡å™¨å®ç°çš„åŠŸèƒ½è¦†ç›–åº¦
- ç¡®å®šè¿ç§»æˆæœ¬å’Œé£é™©

**æ­¥éª¤3ï¼šæ‰§è¡Œè¿ç§»ï¼ˆæ–¹æ¡ˆAï¼‰**
```python
# 1. ä¿®æ”¹ new_api_server.py
# å–æ¶ˆæ³¨é‡Šæ¨¡å—åŒ–è·¯ç”±æ³¨å†Œ
from app.api.project import router as project_router
app.include_router(project_router, prefix="/api", tags=["é¡¹ç›®ç®¡ç†"])

# 2. ç§»é™¤é‡å¤å®ç°
# æ³¨é‡Šæ‰æ‰€æœ‰ @app.get("/api/projects/...") å®šä¹‰

# 3. éªŒè¯æ¨¡å—åŒ–è·¯ç”±å®Œæ•´æ€§
# ç¡®ä¿æ‰€æœ‰å¿…éœ€çš„APIç«¯ç‚¹éƒ½å·²å®ç°
```

**æ­¥éª¤4ï¼šå‰ç«¯é€‚é…**
```typescript
// ç¡®ä¿APIåŸºç¡€URLé…ç½®æ­£ç¡®
const API_BASE_URL = process.env.REACT_APP_API_BASE_URL || 'http://127.0.0.1:9958';
const api = axios.create({
  baseURL: API_BASE_URL + '/api',  // ç»Ÿä¸€æ·»åŠ  /api å‰ç¼€
});

// APIè°ƒç”¨ä½¿ç”¨ç›¸å¯¹è·¯å¾„
getProjectFiles: (projectId: string) => api.get(`/projects/${projectId}/files`)
// æœ€ç»ˆè¯·æ±‚: http://127.0.0.1:9958/api/projects/{id}/files
```

**æ­¥éª¤5ï¼šæµ‹è¯•éªŒè¯**
```bash
# æµ‹è¯•æ‰€æœ‰é¡¹ç›®ç›¸å…³API
curl -X GET "http://localhost:9958/api/projects/11/config"
curl -X GET "http://localhost:9958/api/projects/11/files"
curl -X GET "http://localhost:9958/api/projects/11/analysis-status"
```

#### 1.4 APIç‰ˆæœ¬ç®¡ç†

```python
# ä½¿ç”¨ç‰ˆæœ¬å‰ç¼€é¿å…å†²çª
app.include_router(project_router_v1, prefix="/api/v1")
app.include_router(project_router_v2, prefix="/api/v2")

# æˆ–ä½¿ç”¨ç‰ˆæœ¬å·å‚æ•°
@router.get("/{project_id}/progress")
async def get_project_progress(project_id: str, version: str = "v1"):
    if version == "v1":
        return legacy_implementation()
    elif version == "v2":
        return new_implementation()
```

#### 1.5 è·¯ç”±å†²çªé¢„é˜²æœºåˆ¶

**å»ºç«‹æ£€æŸ¥æ¸…å•**ï¼š
```markdown
## APIå¼€å‘æ£€æŸ¥æ¸…å•

### æ–°å¢APIå‰æ£€æŸ¥
- [ ] æœç´¢æ˜¯å¦å·²å­˜åœ¨ç›¸åŒè·¯å¾„çš„APIå®šä¹‰
- [ ] ç¡®è®¤APIå½’å±çš„æ¨¡å—å’Œæ–‡ä»¶ä½ç½®
- [ ] æ£€æŸ¥è·¯å¾„å‰ç¼€æ˜¯å¦ç¬¦åˆè§„èŒƒ
- [ ] éªŒè¯å‚æ•°ç±»å‹å’Œå“åº”æ ¼å¼ç»Ÿä¸€æ€§

### è·¯ç”±æ³¨å†Œæ£€æŸ¥
- [ ] ç¡®è®¤åªåœ¨ä¸€ä¸ªåœ°æ–¹æ³¨å†Œè·¯ç”±
- [ ] éªŒè¯å‰ç¼€é…ç½®æ­£ç¡®æ€§
- [ ] æµ‹è¯•æœ€ç»ˆç”Ÿæˆçš„å®Œæ•´è·¯å¾„
- [ ] æ£€æŸ¥æ˜¯å¦ä¸ç°æœ‰è·¯ç”±å†²çª

### éƒ¨ç½²å‰éªŒè¯
- [ ] è¿è¡Œè·¯ç”±å†²çªæ£€æµ‹è„šæœ¬
- [ ] æµ‹è¯•æ‰€æœ‰ç›¸å…³APIç«¯ç‚¹
- [ ] éªŒè¯å‰ç«¯è°ƒç”¨æ­£å¸¸
- [ ] æ£€æŸ¥APIæ–‡æ¡£ç”Ÿæˆæ­£ç¡®
```

**è‡ªåŠ¨åŒ–æ£€æµ‹è„šæœ¬**ï¼š
```python
# scripts/check_route_conflicts.py
import re
import os
from pathlib import Path

def check_route_conflicts():
    """æ£€æµ‹APIè·¯ç”±å†²çª"""
    routes = {}
    conflicts = []

    # æ‰«ææ‰€æœ‰Pythonæ–‡ä»¶ä¸­çš„è·¯ç”±å®šä¹‰
    for py_file in Path("backend").rglob("*.py"):
        with open(py_file, 'r', encoding='utf-8') as f:
            content = f.read()
            # æŸ¥æ‰¾è·¯ç”±å®šä¹‰
            patterns = [
                r'@app\.(get|post|put|delete)\("([^"]+)"\)',
                r'@router\.(get|post|put|delete)\("([^"]+)"\)'
            ]
            for pattern in patterns:
                matches = re.findall(pattern, content)
                for method, path in matches:
                    route_key = f"{method.upper()} {path}"
                    if route_key in routes:
                        conflicts.append({
                            'route': route_key,
                            'files': [routes[route_key], str(py_file)]
                        })
                    else:
                        routes[route_key] = str(py_file)

    return conflicts

if __name__ == "__main__":
    conflicts = check_route_conflicts()
    if conflicts:
        print("âŒ å‘ç°è·¯ç”±å†²çª:")
        for conflict in conflicts:
            print(f"  {conflict['route']}")
            for file in conflict['files']:
                print(f"    - {file}")
    else:
        print("âœ… æœªå‘ç°è·¯ç”±å†²çª")
```

### 2. å“åº”æ ¼å¼ç»Ÿä¸€è§„èŒƒ

#### 2.1 ç»Ÿä¸€å“åº”æ ¼å¼

**é—®é¢˜**ï¼šä¸åŒAPIè¿”å›ä¸åŒæ ¼å¼çš„å“åº”ï¼Œå¯¼è‡´å‰ç«¯å¤„ç†å›°éš¾

```python
# âŒ é”™è¯¯ï¼šå¤šç§å“åº”æ ¼å¼
# æ ¼å¼1: FastAPI HTTPException
raise HTTPException(status_code=404, detail="é¡¹ç›®ä¸å­˜åœ¨")
# è¿”å›: {"detail": "é¡¹ç›®ä¸å­˜åœ¨"}

# æ ¼å¼2: è‡ªå®šä¹‰å“åº”
return {"success": False, "message": "é¡¹ç›®ä¸å­˜åœ¨"}

# æ ¼å¼3: APIResponseç±»
return APIResponse.error("é¡¹ç›®ä¸å­˜åœ¨", 400)
# è¿”å›: {"code": 400, "message": "é¡¹ç›®ä¸å­˜åœ¨", "data": null, "success": false}
```

**è§£å†³æ–¹æ¡ˆ**ï¼šç»Ÿä¸€ä½¿ç”¨æ ‡å‡†å“åº”æ ¼å¼

```python
# âœ… æ­£ç¡®ï¼šç»Ÿä¸€å“åº”æ ¼å¼
def create_response(success: bool = True, message: str = "æ“ä½œæˆåŠŸ",
                   data: Any = None, code: int = 200) -> Dict[str, Any]:
    """åˆ›å»ºæ ‡å‡†å“åº”æ ¼å¼"""
    return {
        "success": success,
        "message": message,
        "data": data,
        "code": code
    }

def create_error_response(message: str, code: int = 400) -> JSONResponse:
    """åˆ›å»ºæ ‡å‡†é”™è¯¯å“åº”"""
    return JSONResponse(
        status_code=code,
        content=create_response(success=False, message=message, code=code)
    )

# ä½¿ç”¨ç¤ºä¾‹
@router.get("/{project_id}/progress")
async def get_project_progress(project_id: str):
    try:
        # ä¸šåŠ¡é€»è¾‘
        if not project_exists(project_id):
            return create_error_response("é¡¹ç›®ä¸å­˜åœ¨", 404)

        data = get_progress_data(project_id)
        return create_response(success=True, message="è·å–æˆåŠŸ", data=data)

    except Exception as e:
        return create_error_response(f"æœåŠ¡å™¨é”™è¯¯: {str(e)}", 500)
```

#### 2.2 å‰ç«¯å“åº”å¤„ç†æ ‡å‡†

```typescript
// ç»Ÿä¸€çš„APIå“åº”å¤„ç†
interface APIResponse<T = any> {
  success: boolean;
  message: string;
  data: T;
  code: number;
}

// ç»Ÿä¸€çš„é”™è¯¯å¤„ç†
async function handleAPICall<T>(apiCall: () => Promise<Response>): Promise<T> {
  try {
    const response = await apiCall();
    const data: APIResponse<T> = await response.json();

    if (!data.success) {
      throw new Error(data.message || 'æ“ä½œå¤±è´¥');
    }

    return data.data;
  } catch (error: any) {
    console.error('APIè°ƒç”¨å¤±è´¥:', error);
    throw error;
  }
}

// ä½¿ç”¨ç¤ºä¾‹
const projectProgress = await handleAPICall<ProjectProgress>(() =>
  fetch(`/api/projects/${projectId}/progress`)
);
```

### 3. é”™è¯¯å¤„ç†æ ‡å‡†

```typescript
// å‰ç«¯é”™è¯¯å¤„ç†
try {
  const response = await api.call();
  if (!response.success) {
    throw new Error(response.message);
  }
  return response.data;
} catch (error: any) {
  console.error(`[${stepKey}] æ“ä½œå¤±è´¥:`, error);
  message.error(error.message || 'æ“ä½œå¤±è´¥');
  throw error;
}
```

```python
# åç«¯é”™è¯¯å¤„ç†
try:
    # ä¸šåŠ¡é€»è¾‘
    result = execute_business_logic()
    return create_response(success=True, data=result)
except ValidationError as e:
    return create_error_response(f"å‚æ•°éªŒè¯å¤±è´¥: {str(e)}", 400)
except BusinessLogicError as e:
    return create_error_response(f"ä¸šåŠ¡é€»è¾‘é”™è¯¯: {str(e)}", 422)
except Exception as e:
    logger.error(f"æœªé¢„æœŸé”™è¯¯: {e}")
    return create_error_response("æœåŠ¡å™¨å†…éƒ¨é”™è¯¯", 500)
```

### 2. æ—¥å¿—è®°å½•æ ‡å‡†

```typescript
// å‰ç«¯æ—¥å¿—æ ‡å‡†
console.log(`ğŸ”„ [${stepKey}] å¼€å§‹æ‰§è¡Œæ­¥éª¤`);
console.log(`âœ… [${stepKey}] æ­¥éª¤æ‰§è¡ŒæˆåŠŸ`);
console.error(`âŒ [${stepKey}] æ­¥éª¤æ‰§è¡Œå¤±è´¥:`, error);
```

```python
# åç«¯æ—¥å¿—æ ‡å‡†
logger.info(f"ğŸ”„ [{step_key}] å¼€å§‹æ‰§è¡Œæ­¥éª¤: project_id={project_id}")
logger.info(f"âœ… [{step_key}] æ­¥éª¤æ‰§è¡ŒæˆåŠŸ: project_id={project_id}")
logger.error(f"âŒ [{step_key}] æ­¥éª¤æ‰§è¡Œå¤±è´¥: project_id={project_id}, error={str(e)}")
```

### 4. æ•°æ®åº“è®¿é—®è§„èŒƒ

#### 4.1 é¿å…é‡å¤æ•°æ®åº“è¿æ¥

**é—®é¢˜**ï¼šå¤šä¸ªåœ°æ–¹ç›´æ¥è®¿é—®æ•°æ®åº“ï¼Œå¯¼è‡´è¿æ¥ç®¡ç†æ··ä¹±

```python
# âŒ é”™è¯¯ï¼šåˆ°å¤„éƒ½æ˜¯æ•°æ®åº“è¿æ¥
# æ–‡ä»¶1: new_api_server.py
@app.get("/api/projects/{project_id}/progress")
async def get_project_progress(project_id: str):
    conn = sqlite3.connect("ztbai.db")  # ç›´æ¥è¿æ¥
    cursor = conn.cursor()
    # ...

# æ–‡ä»¶2: app/services/project_service.py
def get_project(self, project_id: str):
    with sqlite3.connect(self.db_path) as conn:  # å¦ä¸€ä¸ªè¿æ¥
        # ...
```

**è§£å†³æ–¹æ¡ˆ**ï¼šç»Ÿä¸€æ•°æ®åº“è®¿é—®å±‚

```python
# âœ… æ­£ç¡®ï¼šç»Ÿä¸€æ•°æ®åº“è®¿é—®
class DatabaseManager:
    def __init__(self, db_path: str):
        self.db_path = db_path

    def execute_single(self, query: str, params: tuple = ()):
        with sqlite3.connect(self.db_path) as conn:
            conn.row_factory = sqlite3.Row
            cursor = conn.cursor()
            cursor.execute(query, params)
            return cursor.fetchone()

# ç»Ÿä¸€çš„é¡¹ç›®æ•°æ®è®¿é—®
class ProjectRepository:
    @staticmethod
    def get_project_by_id(project_id: str) -> Optional[Dict]:
        query = "SELECT * FROM projects WHERE id = ?"
        return db_manager.execute_single(query, (project_id,))

# APIä¸­ä½¿ç”¨ç»Ÿä¸€çš„Repository
@router.get("/{project_id}/progress")
async def get_project_progress(project_id: str):
    project = ProjectRepository.get_project_by_id(project_id)
    if not project:
        return create_error_response("é¡¹ç›®ä¸å­˜åœ¨", 404)
```

#### 4.2 å‚æ•°ç±»å‹è½¬æ¢è§„èŒƒ

```python
# ç»Ÿä¸€çš„å‚æ•°å¤„ç†
def safe_convert_project_id(project_id: str) -> Optional[int]:
    """å®‰å…¨è½¬æ¢é¡¹ç›®ID"""
    try:
        return int(project_id) if project_id.isdigit() else None
    except (ValueError, AttributeError):
        return None

# åœ¨APIä¸­ä½¿ç”¨
@router.get("/{project_id}/progress")
async def get_project_progress(project_id: str):
    # ç»Ÿä¸€çš„å‚æ•°éªŒè¯å’Œè½¬æ¢
    if not project_id:
        return create_error_response("é¡¹ç›®IDä¸èƒ½ä¸ºç©º", 400)

    # æ ¹æ®ä¸šåŠ¡éœ€è¦å†³å®šæ˜¯å¦è½¬æ¢ç±»å‹
    project = ProjectRepository.get_project_by_id(project_id)  # ç›´æ¥ä½¿ç”¨å­—ç¬¦ä¸²
    # æˆ–
    project_id_int = safe_convert_project_id(project_id)
    if project_id_int is None:
        return create_error_response("æ— æ•ˆçš„é¡¹ç›®IDæ ¼å¼", 400)
```

### 5. å†²çªæ£€æµ‹å’Œé¢„é˜²å·¥å…·

#### 5.1 å¼€å‘å‰æ£€æŸ¥è„šæœ¬

```bash
#!/bin/bash
# check_api_conflicts.sh - APIå†²çªæ£€æµ‹è„šæœ¬

echo "ğŸ” æ£€æŸ¥APIè·¯ç”±å†²çª..."

# æ£€æŸ¥é‡å¤çš„è·¯ç”±å®šä¹‰
echo "ğŸ“‹ æ£€æŸ¥é‡å¤è·¯ç”±å®šä¹‰:"
grep -r "@.*\.get.*projects.*progress" backend/ || echo "  æ— é‡å¤è¿›å±•API"
grep -r "@.*\.get.*projects.*files" backend/ || echo "  æ— é‡å¤æ–‡ä»¶API"

# æ£€æŸ¥è·¯ç”±æ³¨å†Œ
echo "ğŸ“‹ æ£€æŸ¥è·¯ç”±æ³¨å†Œ:"
grep -r "include_router" backend/ | grep -v "__pycache__"
grep -r "@app\." backend/ | grep -v "__pycache__" | head -10

# æ£€æŸ¥å‚æ•°ç±»å‹ä¸€è‡´æ€§
echo "ğŸ“‹ æ£€æŸ¥å‚æ•°ç±»å‹:"
grep -r "project_id: str" backend/ | wc -l | xargs echo "  strç±»å‹å‚æ•°:"
grep -r "project_id: int" backend/ | wc -l | xargs echo "  intç±»å‹å‚æ•°:"

echo "âœ… å†²çªæ£€æŸ¥å®Œæˆ"
```

#### 5.2 ä»£ç å®¡æŸ¥æ£€æŸ¥ç‚¹

**APIå¼€å‘å®¡æŸ¥æ¸…å•**ï¼š
- [ ] ç¡®è®¤APIè·¯ç”±åœ¨é¡¹ç›®ä¸­å”¯ä¸€
- [ ] å‚æ•°ç±»å‹ä¸å…¶ä»–ç›¸å…³APIä¸€è‡´
- [ ] å“åº”æ ¼å¼ç¬¦åˆç»Ÿä¸€æ ‡å‡†
- [ ] é”™è¯¯å¤„ç†ä½¿ç”¨ç»Ÿä¸€æ–¹æ³•
- [ ] æ•°æ®åº“è®¿é—®é€šè¿‡ç»Ÿä¸€Repository
- [ ] æ·»åŠ äº†é€‚å½“çš„æ—¥å¿—è®°å½•
- [ ] ç¼–å†™äº†å¯¹åº”çš„æµ‹è¯•ç”¨ä¾‹

### 6. æµ‹è¯•æ ‡å‡†

```typescript
// å‰ç«¯æµ‹è¯•æ¨¡æ¿
describe('StepPage', () => {
  it('should load step data on mount', async () => {
    // æµ‹è¯•æ•°æ®åŠ è½½
  });
  
  it('should execute step successfully', async () => {
    // æµ‹è¯•æ­¥éª¤æ‰§è¡Œ
  });
  
  it('should handle errors gracefully', async () => {
    // æµ‹è¯•é”™è¯¯å¤„ç†
  });
});
```

## ï¿½ å®é™…æ¡ˆä¾‹åˆ†æ

### æ¡ˆä¾‹1ï¼šæ–‡ä»¶å†…å®¹è¯»å–APIå†²çª

**é—®é¢˜æè¿°**ï¼š
2025å¹´8æœˆ13æ—¥å‘ç°çš„å®é™…å†²çªæ¡ˆä¾‹ï¼Œç”¨æˆ·æŠ¥å‘Š"æŸ¥çœ‹å†…å®¹"æŒ‰é’®è¿”å›404é”™è¯¯ã€‚

**å†²çªåŸå› **ï¼š
1. **è·¯ç”±å‰ç¼€é‡å¤**ï¼š
   ```python
   # app/api/project.py
   router = APIRouter(prefix="/api/projects", tags=["projects"])

   # new_api_server.py
   app.include_router(project_router, prefix="/api", tags=["é¡¹ç›®ç®¡ç†"])

   # ç»“æœï¼š/api/api/projects/{project_id}/files/{filename} - é”™è¯¯ï¼
   ```

2. **å‚æ•°ç±»å‹å†²çª**ï¼š
   ```python
   # app/api/project.py
   async def get_project_progress(project_id: int):  # intç±»å‹

   # new_api_server.py
   async def get_project_progress(project_id: str):  # strç±»å‹

   # å‰ç«¯ä¼ é€’"11"ï¼Œintç±»å‹APIæ— æ³•å¤„ç†å­—ç¬¦ä¸²
   ```

**è§£å†³è¿‡ç¨‹**ï¼š
1. **ä¸´æ—¶æ–¹æ¡ˆ**ï¼šç¦ç”¨æ¨¡å—åŒ–è·¯ç”±æ³¨å†Œ - å¯¼è‡´æ–°é—®é¢˜
2. **æ­£ç¡®æ–¹æ¡ˆ**ï¼šä¿®å¤è·¯ç”±å‰ç¼€ï¼Œç»Ÿä¸€å‚æ•°ç±»å‹

**ç»éªŒæ•™è®­**ï¼š
- ä¸è¦ç®€å•ç¦ç”¨åŠŸèƒ½æ¥è§£å†³å†²çª
- è¦ä»æ ¹æœ¬ä¸Šè§£å†³æ¶æ„é—®é¢˜
- ä¿®å¤ä¸€ä¸ªé—®é¢˜æ—¶è¦è€ƒè™‘å¯¹å…¶ä»–åŠŸèƒ½çš„å½±å“

### æ¡ˆä¾‹2ï¼šé¡¹ç›®è¿›å±•APIå†²çª

**é—®é¢˜æè¿°**ï¼š
ä¿®å¤æ–‡ä»¶å†…å®¹APIåï¼Œé¡¹ç›®è¿›å±•APIè¿”å›400é”™è¯¯"é¡¹ç›®ä¸å­˜åœ¨"ã€‚

**æ ¹æœ¬åŸå› **ï¼š
```python
# å¤šä¸ªåœ°æ–¹å®šä¹‰äº†ç›¸åŒçš„APIï¼Œä½†å®ç°ä¸åŒ
# 1. new_api_server.py - ç›´æ¥æ•°æ®åº“æŸ¥è¯¢
# 2. app/api/project.py - é€šè¿‡æœåŠ¡å±‚æŸ¥è¯¢
# 3. app/services/project_service.py - æœŸæœ›intç±»å‹å‚æ•°

# å¯¼è‡´è·¯ç”±å†²çªå’Œå‚æ•°ç±»å‹ä¸åŒ¹é…
```

**æ­£ç¡®è§£å†³æ–¹æ¡ˆ**ï¼š
```python
# 1. ç»Ÿä¸€APIå®šä¹‰ä½ç½®
# 2. ç»Ÿä¸€å‚æ•°ç±»å‹ä¸ºå­—ç¬¦ä¸²
# 3. ç»Ÿä¸€å“åº”æ ¼å¼
# 4. ç»Ÿä¸€é”™è¯¯å¤„ç†
```

## ï¿½ğŸ“‹ å®æ–½æ£€æŸ¥æ¸…å•

### æ–°æ­¥éª¤å¼€å‘æ£€æŸ¥æ¸…å•

- [ ] **å‰ç«¯é¡µé¢ç»„ä»¶**
  - [ ] ä½¿ç”¨æ ‡å‡†é¡µé¢ç»„ä»¶æ¨¡æ¿
  - [ ] é›†æˆ `useStepProgress` Hook
  - [ ] å®ç°ç»Ÿä¸€çš„é”™è¯¯å¤„ç†
  - [ ] æ·»åŠ  `ProjectStepNavigation` ç»„ä»¶

- [ ] **APIæœåŠ¡å±‚**
  - [ ] å®ç°æ ‡å‡†APIè°ƒç”¨æ–¹æ³•
  - [ ] ä½¿ç”¨ç»Ÿä¸€çš„å“åº”æ ¼å¼
  - [ ] æ·»åŠ é€‚å½“çš„é”™è¯¯å¤„ç†

- [ ] **åç«¯API**
  - [ ] å®ç°æ ‡å‡†APIç«¯ç‚¹ç»“æ„
  - [ ] ä½¿ç”¨ç»Ÿä¸€çš„å“åº”æ ¼å¼
  - [ ] é›†æˆæ­¥éª¤è¿›åº¦æ›´æ–°

- [ ] **æ•°æ®åº“æ“ä½œ**
  - [ ] ä½¿ç”¨æ ‡å‡†çš„è¿›åº¦æ›´æ–°å‡½æ•°
  - [ ] ç¡®ä¿æ•°æ®ä¸€è‡´æ€§
  - [ ] æ·»åŠ é€‚å½“çš„ç´¢å¼•

- [ ] **æµ‹è¯•è¦†ç›–**
  - [ ] å•å…ƒæµ‹è¯•
  - [ ] é›†æˆæµ‹è¯•
  - [ ] ç«¯åˆ°ç«¯æµ‹è¯•

### ä»£ç å®¡æŸ¥æ£€æŸ¥æ¸…å•

- [ ] **ä»£ç è´¨é‡**
  - [ ] éµå¾ªTypeScript/Pythonç¼–ç è§„èŒƒ
  - [ ] é€‚å½“çš„ç±»å‹æ³¨è§£
  - [ ] æ¸…æ™°çš„å˜é‡å’Œå‡½æ•°å‘½å

- [ ] **æ¶æ„ä¸€è‡´æ€§**
  - [ ] éµå¾ªç»Ÿä¸€çš„æ•°æ®æµè½¬æ¨¡å¼
  - [ ] ä½¿ç”¨æ ‡å‡†çš„ç»„ä»¶ç»“æ„
  - [ ] æ­£ç¡®çš„é”™è¯¯å¤„ç†

- [ ] **æ€§èƒ½è€ƒè™‘**
  - [ ] é¿å…ä¸å¿…è¦çš„é‡æ–°æ¸²æŸ“
  - [ ] é€‚å½“çš„ç¼“å­˜ç­–ç•¥
  - [ ] æ•°æ®åº“æŸ¥è¯¢ä¼˜åŒ–

## ğŸš€ å…·ä½“æ­¥éª¤å®æ–½æŒ‡å—

### 1. æŠ•æ ‡æ–‡ä»¶åˆå§‹åŒ– (file-formatting)

#### é¢„æœŸåŠŸèƒ½
- æ–‡ä»¶æ ¼å¼æ£€æµ‹å’Œè½¬æ¢
- æ–‡æ¡£ç»“æ„åˆ†æ
- åˆå§‹åŒ–é¡¹ç›®æ–‡ä»¶ç»“æ„

#### å®æ–½è¦ç‚¹
```typescript
// å‰ç«¯å®ç°è¦ç‚¹
const FileFormattingPage: React.FC = () => {
  const { markStepCompleted, markStepInProgress } = useStepProgress(projectId, 'file-formatting');

  const handleFormatFiles = async () => {
    markStepInProgress(10);
    const result = await fileAPI.formatFiles(projectId, formatConfig);
    if (result.success) {
      markStepCompleted({ formatResult: result.data });
    }
  };
};
```

#### APIç«¯ç‚¹è®¾è®¡
```
GET  /api/projects/{project_id}/files/format-status
POST /api/projects/{project_id}/files/format
GET  /api/projects/{project_id}/files/format-result
```

### 2. èµ„æ–™ç®¡ç† (material-management)

#### é¢„æœŸåŠŸèƒ½
- èµ„æ–™æ–‡ä»¶ä¸Šä¼ 
- èµ„æ–™åˆ†ç±»å’Œæ ‡è®°
- èµ„æ–™å†…å®¹åˆ†æ

#### å®æ–½è¦ç‚¹
```typescript
const MaterialManagementPage: React.FC = () => {
  const { markStepCompleted, markStepInProgress } = useStepProgress(projectId, 'material-management');

  const handleUploadMaterials = async (files: File[]) => {
    markStepInProgress(0);
    const result = await materialAPI.uploadMaterials(projectId, files);
    if (result.success && result.data.materials.length > 0) {
      markStepCompleted({ materials: result.data.materials });
    }
  };
};
```

### 3. æ¡†æ¶ç”Ÿæˆ (framework-generation)

#### é¢„æœŸåŠŸèƒ½
- åŸºäºåˆ†æç»“æœç”Ÿæˆæ–‡æ¡£æ¡†æ¶
- æ¡†æ¶ç»“æ„å¯è§†åŒ–
- æ¡†æ¶å†…å®¹é¢„è§ˆ

#### å®æ–½è¦ç‚¹
```typescript
const FrameworkGenerationPage: React.FC = () => {
  const { markStepCompleted, markStepInProgress } = useStepProgress(projectId, 'framework-generation');

  const handleGenerateFramework = async () => {
    markStepInProgress(0);
    const taskId = await frameworkAPI.startGeneration(projectId);
    monitorGenerationProgress(taskId);
  };
};
```

### 4. å†…å®¹ç”Ÿæˆ (content-generation)

#### é¢„æœŸåŠŸèƒ½
- AIè¾…åŠ©å†…å®¹ç”Ÿæˆ
- åˆ†æ®µå†…å®¹ç¼–è¾‘
- å†…å®¹è´¨é‡æ£€æŸ¥

#### å®æ–½è¦ç‚¹
```typescript
const ContentGenerationPage: React.FC = () => {
  const { markStepCompleted, markStepInProgress } = useStepProgress(projectId, 'content-generation');

  const handleGenerateContent = async (sectionKey: string) => {
    markStepInProgress(calculateProgress());
    const result = await contentAPI.generateSection(projectId, sectionKey);
    updateSectionStatus(sectionKey, 'generated');

    // æ£€æŸ¥æ˜¯å¦æ‰€æœ‰å¿…è¦ç« èŠ‚éƒ½å·²ç”Ÿæˆ
    if (allRequiredSectionsGenerated()) {
      markStepCompleted({ contentSections: getAllSections() });
    }
  };
};
```

### 5. æ ¼å¼é…ç½® (format-config)

#### é¢„æœŸåŠŸèƒ½
- æ–‡æ¡£æ ·å¼é…ç½®
- æ ¼å¼æ¨¡æ¿é€‰æ‹©
- è‡ªå®šä¹‰æ ·å¼è®¾ç½®

#### å®æ–½è¦ç‚¹
```typescript
const FormatConfigPage: React.FC = () => {
  const { markStepCompleted, markStepInProgress } = useStepProgress(projectId, 'format-config');

  const handleSaveConfig = async (config: FormatConfig) => {
    markStepInProgress(50);
    const result = await formatAPI.saveConfig(projectId, config);
    if (result.success) {
      markStepCompleted({ configSaved: true, config });
    }
  };
};
```

### 6. æ–‡æ¡£å¯¼å‡º (document-export)

#### é¢„æœŸåŠŸèƒ½
- å¤šæ ¼å¼æ–‡æ¡£å¯¼å‡º
- å¯¼å‡ºå†å²è®°å½•
- æ–‡æ¡£é¢„è§ˆå’Œä¸‹è½½

#### å®æ–½è¦ç‚¹
```typescript
const DocumentExportPage: React.FC = () => {
  const { markStepCompleted, markStepInProgress } = useStepProgress(projectId, 'document-export');

  const handleExportDocument = async (format: string) => {
    markStepInProgress(0);
    const taskId = await exportAPI.startExport(projectId, format);
    monitorExportProgress(taskId);
  };

  const onExportComplete = (exportData: any) => {
    markStepCompleted({
      exportHistory: [...existingHistory, exportData]
    });
  };
};
```

## ğŸ” è´¨é‡ä¿è¯å’Œç›‘æ§

### 1. æ€§èƒ½ç›‘æ§æŒ‡æ ‡

```typescript
// å‰ç«¯æ€§èƒ½ç›‘æ§
const performanceMetrics = {
  stepLoadTime: Date.now() - startTime,
  apiResponseTime: responseTime,
  userInteractionDelay: interactionTime,
  memoryUsage: performance.memory?.usedJSHeapSize
};

// å‘é€åˆ°ç›‘æ§ç³»ç»Ÿ
analytics.track('step_performance', {
  projectId,
  stepKey,
  metrics: performanceMetrics
});
```

### 2. é”™è¯¯ç›‘æ§å’ŒæŠ¥å‘Š

```python
# åç«¯é”™è¯¯ç›‘æ§
import logging
from datetime import datetime

def log_step_error(project_id: str, step_key: str, error: Exception):
    """ç»Ÿä¸€çš„é”™è¯¯æ—¥å¿—è®°å½•"""
    error_data = {
        "timestamp": datetime.now().isoformat(),
        "project_id": project_id,
        "step_key": step_key,
        "error_type": type(error).__name__,
        "error_message": str(error),
        "stack_trace": traceback.format_exc()
    }

    # è®°å½•åˆ°æ—¥å¿—æ–‡ä»¶
    logging.error(f"Step execution error: {json.dumps(error_data)}")

    # å‘é€åˆ°ç›‘æ§ç³»ç»Ÿï¼ˆå¦‚æœé…ç½®äº†ï¼‰
    if monitoring_enabled:
        send_to_monitoring_system(error_data)
```

### 3. æ•°æ®ä¸€è‡´æ€§æ£€æŸ¥

```python
def validate_step_data_consistency(project_id: str):
    """éªŒè¯æ­¥éª¤æ•°æ®ä¸€è‡´æ€§"""
    with sqlite3.connect(DB_PATH) as conn:
        cursor = conn.cursor()

        # æ£€æŸ¥æ‰€æœ‰æ­¥éª¤æ˜¯å¦éƒ½æœ‰è®°å½•
        cursor.execute("""
            SELECT COUNT(*) FROM project_step_progress
            WHERE project_id = ?
        """, (project_id,))

        step_count = cursor.fetchone()[0]
        expected_steps = len(WORKFLOW_STEPS)

        if step_count != expected_steps:
            logger.warning(f"é¡¹ç›® {project_id} æ­¥éª¤æ•°æ®ä¸å®Œæ•´: {step_count}/{expected_steps}")
            return False

        # æ£€æŸ¥è¿›åº¦å€¼æ˜¯å¦åœ¨æœ‰æ•ˆèŒƒå›´å†…
        cursor.execute("""
            SELECT step_key, progress FROM project_step_progress
            WHERE project_id = ? AND (progress < 0 OR progress > 100)
        """, (project_id,))

        invalid_progress = cursor.fetchall()
        if invalid_progress:
            logger.error(f"é¡¹ç›® {project_id} å­˜åœ¨æ— æ•ˆè¿›åº¦å€¼: {invalid_progress}")
            return False

        return True
```

## ğŸ“Š æ•°æ®è¿ç§»å’Œå‡çº§ç­–ç•¥

### 1. æ•°æ®åº“ç‰ˆæœ¬ç®¡ç†

```python
# æ•°æ®åº“è¿ç§»è„šæœ¬æ¨¡æ¿
def migrate_to_version_2():
    """è¿ç§»åˆ°ç‰ˆæœ¬2çš„æ•°æ®åº“ç»“æ„"""
    with sqlite3.connect(DB_PATH) as conn:
        cursor = conn.cursor()

        # æ·»åŠ æ–°å­—æ®µ
        try:
            cursor.execute("""
                ALTER TABLE project_step_progress
                ADD COLUMN version INTEGER DEFAULT 1
            """)
        except sqlite3.OperationalError:
            # å­—æ®µå·²å­˜åœ¨
            pass

        # æ›´æ–°ç°æœ‰æ•°æ®
        cursor.execute("""
            UPDATE project_step_progress
            SET version = 2
            WHERE version IS NULL OR version < 2
        """)

        conn.commit()
        logger.info("æ•°æ®åº“è¿ç§»åˆ°ç‰ˆæœ¬2å®Œæˆ")
```

### 2. é…ç½®æ–‡ä»¶ç‰ˆæœ¬æ§åˆ¶

```json
{
  "version": "2.0",
  "migration_history": [
    {
      "from_version": "1.0",
      "to_version": "2.0",
      "migrated_at": "2025-08-13T10:00:00Z",
      "changes": [
        "æ·»åŠ æ­¥éª¤ç‰ˆæœ¬å­—æ®µ",
        "ä¼˜åŒ–è¿›åº¦è®¡ç®—é€»è¾‘"
      ]
    }
  ],
  "current_schema": {
    "project_step_progress": {
      "version": 2,
      "fields": ["id", "project_id", "step_key", "status", "progress", "version"]
    }
  }
}
```

## ğŸ¯ æ€»ç»“

æœ¬è§„èŒƒæ–‡æ¡£åŸºäºå¯¹ç°æœ‰æœåŠ¡æ¨¡å¼é€‰æ‹©å’Œæ‹›æ ‡æ–‡ä»¶åˆ†ææ­¥éª¤çš„æ·±å…¥åˆ†æï¼Œæä¾›äº†ï¼š

1. **ç»Ÿä¸€çš„æ¶æ„æ¨¡å¼** - ç¡®ä¿æ‰€æœ‰æ­¥éª¤éµå¾ªä¸€è‡´çš„å®ç°æ–¹å¼
2. **æ ‡å‡†åŒ–çš„APIé€šä¿¡** - ç»Ÿä¸€å‰åç«¯æ•°æ®äº¤äº’æ ¼å¼
3. **è§„èŒƒåŒ–çš„çŠ¶æ€ç®¡ç†** - ç»Ÿä¸€çš„è¿›åº¦è·Ÿè¸ªå’ŒçŠ¶æ€æ›´æ–°æœºåˆ¶
4. **å®Œæ•´çš„é”™è¯¯å¤„ç†** - ç»Ÿä¸€çš„é”™è¯¯å¤„ç†å’Œç”¨æˆ·åé¦ˆ
5. **å¯ç»´æŠ¤çš„ä»£ç ç»“æ„** - æ¸…æ™°çš„ä»£ç ç»„ç»‡å’Œå‘½åè§„èŒƒ
6. **è´¨é‡ä¿è¯ä½“ç³»** - æ€§èƒ½ç›‘æ§ã€é”™è¯¯è¿½è¸ªã€æ•°æ®ä¸€è‡´æ€§æ£€æŸ¥
7. **å‡çº§è¿ç§»ç­–ç•¥** - æ•°æ®åº“ç‰ˆæœ¬ç®¡ç†å’Œå¹³æ»‘å‡çº§æ–¹æ¡ˆ

## ğŸ›¡ï¸ å†²çªé¢„é˜²æªæ–½

### 1. å¼€å‘æµç¨‹è§„èŒƒ

**å¼€å‘å‰æ£€æŸ¥**ï¼š
```bash
# 1. æ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨ç›¸å…³API
grep -r "projects/{project_id}" backend/
grep -r "@.*\.get.*projects" backend/

# 2. æ£€æŸ¥å‚æ•°ç±»å‹ä¸€è‡´æ€§
grep -r "project_id:" backend/ | grep -E "(str|int)"

# 3. æ£€æŸ¥å“åº”æ ¼å¼
grep -r "create_response\|APIResponse\|HTTPException" backend/
```

**ä»£ç å®¡æŸ¥è¦ç‚¹**ï¼š
- [ ] APIè·¯ç”±åœ¨æ•´ä¸ªé¡¹ç›®ä¸­å”¯ä¸€
- [ ] å‚æ•°ç±»å‹ä¸ç°æœ‰APIä¿æŒä¸€è‡´
- [ ] å“åº”æ ¼å¼ç¬¦åˆé¡¹ç›®æ ‡å‡†
- [ ] é”™è¯¯å¤„ç†æ–¹å¼ç»Ÿä¸€
- [ ] æ•°æ®åº“è®¿é—®é€šè¿‡ç»Ÿä¸€å…¥å£

### 2. æ¶æ„æ²»ç†å»ºè®®

**APIè®¾è®¡åŸåˆ™**ï¼š
1. **å•ä¸€èŒè´£**ï¼šæ¯ä¸ªAPIåªåœ¨ä¸€ä¸ªåœ°æ–¹å®šä¹‰
2. **ç»Ÿä¸€æ ‡å‡†**ï¼šå‚æ•°ç±»å‹ã€å“åº”æ ¼å¼ã€é”™è¯¯å¤„ç†ä¿æŒä¸€è‡´
3. **åˆ†å±‚æ¸…æ™°**ï¼šAPIå±‚ â†’ æœåŠ¡å±‚ â†’ æ•°æ®è®¿é—®å±‚
4. **æ–‡æ¡£å…ˆè¡Œ**ï¼šAPIè®¾è®¡å‰å…ˆæ›´æ–°è§„èŒƒæ–‡æ¡£

**é‡æ„ç­–ç•¥**ï¼š
1. **è¯†åˆ«å†²çª**ï¼šå®šæœŸæ‰«æé‡å¤APIå®šä¹‰
2. **é€æ­¥è¿ç§»**ï¼šå°†åˆ†æ•£çš„APIé€æ­¥è¿ç§»åˆ°ç»Ÿä¸€ä½ç½®
3. **æµ‹è¯•ä¿éšœ**ï¼šæ¯æ¬¡é‡æ„éƒ½è¦æœ‰å®Œæ•´çš„æµ‹è¯•è¦†ç›–
4. **å‘åå…¼å®¹**ï¼šä¿æŒAPIçš„å‘åå…¼å®¹æ€§

### 3. ç›‘æ§å’Œç»´æŠ¤

**å®šæœŸæ£€æŸ¥**ï¼š
- æ¯å‘¨è¿è¡Œå†²çªæ£€æµ‹è„šæœ¬
- æ¯æœˆå®¡æŸ¥APIè®¾è®¡ä¸€è‡´æ€§
- æ¯å­£åº¦æ›´æ–°å¼€å‘è§„èŒƒ

**é—®é¢˜è¿½è¸ª**ï¼š
- è®°å½•æ¯æ¬¡å†²çªçš„åŸå› å’Œè§£å†³æ–¹æ¡ˆ
- å»ºç«‹å†²çªæ¡ˆä¾‹åº“ä¾›å›¢é˜Ÿå­¦ä¹ 
- æŒç»­æ”¹è¿›é¢„é˜²æªæ–½

### å®æ–½å»ºè®®

1. **ç«‹å³æ‰§è¡Œ**: å°†æ­¤è§„èŒƒåº”ç”¨åˆ°æ‰€æœ‰æ–°å¼€å‘çš„æ­¥éª¤ä¸­
2. **é€æ­¥é‡æ„**: å¯¹ç°æœ‰æ­¥éª¤è¿›è¡Œæ¸è¿›å¼é‡æ„ä»¥ç¬¦åˆè§„èŒƒ
3. **æŒç»­æ”¹è¿›**: æ ¹æ®å®é™…ä½¿ç”¨æƒ…å†µä¸æ–­å®Œå–„è§„èŒƒ
4. **å›¢é˜ŸåŸ¹è®­**: ç¡®ä¿æ‰€æœ‰å¼€å‘äººå‘˜ç†è§£å’Œéµå¾ªæ­¤è§„èŒƒ
5. **å·¥å…·æ”¯æŒ**: å¼€å‘è‡ªåŠ¨åŒ–å·¥å…·æ£€æµ‹å’Œé¢„é˜²å†²çª
6. **æ–‡æ¡£ç»´æŠ¤**: åŠæ—¶æ›´æ–°è§„èŒƒæ–‡æ¡£ï¼Œè®°å½•æœ€ä½³å®è·µ

éµå¾ªæ­¤è§„èŒƒå°†ç¡®ä¿åç»­æ­¥éª¤çš„å¼€å‘è´¨é‡å’Œä¸€è‡´æ€§ï¼Œé¿å…æ¶æ„æ··ä¹±å’Œç»´æŠ¤å›°éš¾ï¼Œä¸ºé¡¹ç›®çš„é•¿æœŸå‘å±•å¥ å®šåšå®åŸºç¡€ã€‚

## âš ï¸ é‡è¦æé†’

**æœ¬è§„èŒƒåŸºäº2025å¹´8æœˆ13æ—¥çš„å®é™…å†²çªæ¡ˆä¾‹åˆ¶å®šï¼ŒåŒ…å«äº†çœŸå®çš„é—®é¢˜åˆ†æå’Œè§£å†³æ–¹æ¡ˆã€‚æ‰€æœ‰å¼€å‘äººå‘˜åœ¨è¿›è¡ŒAPIå¼€å‘æ—¶å¿…é¡»ä¸¥æ ¼éµå¾ªæ­¤è§„èŒƒï¼Œé¿å…é‡å¤çŠ¯åŒæ ·çš„é”™è¯¯ã€‚**

**å¦‚å‘ç°æ–°çš„å†²çªæ¨¡å¼æˆ–æœ‰æ”¹è¿›å»ºè®®ï¼Œè¯·åŠæ—¶æ›´æ–°æ­¤æ–‡æ¡£ã€‚**

---

**æ–‡æ¡£ç‰ˆæœ¬**: v2.0 (æ–°å¢APIå†²çªé¢„é˜²è§„èŒƒ)
**åˆ›å»ºæ—¥æœŸ**: 2025-08-13
**æœ€åæ›´æ–°**: 2025-08-13
**ç»´æŠ¤è€…**: ZtbAiå¼€å‘å›¢é˜Ÿ
**æ›´æ–°å†…å®¹**: åŸºäºå®é™…å†²çªæ¡ˆä¾‹æ·»åŠ äº†å®Œæ•´çš„APIè·¯ç”±å†²çªé¢„é˜²å’Œè§£å†³æ–¹æ¡ˆ
