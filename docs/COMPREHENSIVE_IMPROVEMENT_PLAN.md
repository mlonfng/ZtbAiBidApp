# ZtbAiç³»ç»Ÿç»¼åˆæ”¹è¿›æ–¹æ¡ˆ

## ğŸ“‹ é¡¹ç›®æ¦‚è§ˆ

**é¡¹ç›®åç§°**: ZtbAiæ™ºèƒ½æŠ•æ ‡ç³»ç»Ÿ  
**åˆ†ææ—¶é—´**: 2024-08-30  
**åˆ†æç›®æ ‡**: å®ç°ä»æ‹›æ ‡æ–‡ä»¶ä¸Šä¼ åˆ°æŠ•æ ‡æ–‡ä»¶å®Œæ•´è¾“å‡ºçš„ç«¯åˆ°ç«¯ä¸šåŠ¡æµç¨‹  

## ğŸ¯ æ ¸å¿ƒç›®æ ‡

1. **å®Œå–„ä¸šåŠ¡æµç¨‹**: å®ç°å®Œæ•´çš„8æ­¥æŠ•æ ‡æ–‡ä»¶åˆ¶ä½œæµç¨‹
2. **å»é™¤æ¨¡æ‹Ÿä»£ç **: å°†æ‰€æœ‰æ¨¡æ‹Ÿå®ç°æ›¿æ¢ä¸ºçœŸå®ä¸šåŠ¡é€»è¾‘
3. **ä¼˜åŒ–ç³»ç»Ÿæ¶æ„**: æå‡ç³»ç»Ÿæ€§èƒ½ã€å¯ç»´æŠ¤æ€§å’Œæ‰©å±•æ€§
4. **å¢å¼ºç”¨æˆ·ä½“éªŒ**: æä¾›æµç•…çš„ç«¯åˆ°ç«¯æ“ä½œä½“éªŒ

## âœ… å·²å®Œæˆæ”¹è¿›

### 1. æ­¥éª¤5ï¼šæ¡†æ¶ç”ŸæˆæœåŠ¡
- âœ… é›†æˆBidFrameworkAgentçœŸå®AIå®ç°
- âœ… ä»æ•°æ®åº“è·å–åˆ†æç»“æœç”Ÿæˆæ¡†æ¶
- âœ… ä¿å­˜æ¡†æ¶é…ç½®å’Œç« èŠ‚æ¨¡æ¿æ–‡ä»¶
- âœ… å®Œæ•´çš„çŠ¶æ€è·Ÿè¸ªå’Œè¿›åº¦ç®¡ç†

### 2. æ­¥éª¤6ï¼šå†…å®¹ç”ŸæˆæœåŠ¡
- âœ… é›†æˆTechnicalContentAgentå’ŒCommercialContentAgent
- âœ… æ™ºèƒ½ç« èŠ‚ç±»å‹è¯†åˆ«å’ŒAgenté€‰æ‹©
- âœ… æ‰¹é‡å†…å®¹ç”Ÿæˆå’Œæ–‡ä»¶ä¿å­˜
- âœ… è¯¦ç»†çš„ç”Ÿæˆç»Ÿè®¡å’Œé”™è¯¯å¤„ç†

### 3. æ­¥éª¤7ï¼šæ ¼å¼é…ç½®æœåŠ¡
- âœ… å†…ç½®å¤šç§æ–‡æ¡£æ¨¡æ¿ï¼ˆæ ‡å‡†/ä¸“ä¸šï¼‰
- âœ… è‡ªå®šä¹‰é…ç½®åˆå¹¶æœºåˆ¶
- âœ… è‡ªåŠ¨ç”ŸæˆCSSæ ·å¼æ–‡ä»¶
- âœ… å®Œæ•´çš„é…ç½®æŒä¹…åŒ–

### 4. æ­¥éª¤8ï¼šæ–‡æ¡£å¯¼å‡ºæœåŠ¡
- âœ… çœŸå®æ–‡æ¡£å¯¼å‡ºå®ç°ï¼ˆHTML/Markdownï¼‰
- âœ… å¤šæ ¼å¼æ”¯æŒå’Œæ–‡ä»¶ç”Ÿæˆ
- âœ… ä¸»æ–‡æ¡£ã€ç« èŠ‚æ–‡æ¡£ã€é™„ä»¶ç®¡ç†
- âœ… æ–‡ä»¶ä¸‹è½½URLå’Œå¤§å°ç»Ÿè®¡

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„åˆ†æ

### å½“å‰æ¶æ„ä¼˜åŠ¿

1. **å‰åç«¯åˆ†ç¦»**: React+Electronå‰ç«¯ï¼ŒFastAPIåç«¯
2. **æ¨¡å—åŒ–è®¾è®¡**: Step APIä¸‰ä»¶å¥—æ¨¡å¼ï¼ˆstatus/execute/resultï¼‰
3. **AI Agenté›†æˆ**: ç»Ÿä¸€çš„AgentManagerç®¡ç†AIèƒ½åŠ›
4. **æ•°æ®åº“è®¾è®¡**: SQLite + Alembicè¿ç§»ç®¡ç†
5. **å¼‚æ­¥å¤„ç†**: FastAPIå¼‚æ­¥æ”¯æŒï¼Œæ€§èƒ½è‰¯å¥½

### è¯†åˆ«çš„å…³é”®é—®é¢˜

1. **æ–‡ä»¶ä¸‹è½½æœºåˆ¶**: éœ€è¦å¢å¼ºæ–‡ä»¶æœåŠ¡èƒ½åŠ›
2. **å¼‚æ­¥ä»»åŠ¡ç®¡ç†**: é•¿æ—¶é—´ä»»åŠ¡éœ€è¦é˜Ÿåˆ—åŒ–å¤„ç†
3. **é”™è¯¯æ¢å¤æœºåˆ¶**: æ­¥éª¤å¤±è´¥åçš„é‡è¯•å’Œæ¢å¤
4. **èµ„æºç®¡ç†**: æ–‡ä»¶å­˜å‚¨å’Œæ¸…ç†ç­–ç•¥
5. **æ€§èƒ½ç›‘æ§**: ç¼ºå°‘å®Œæ•´çš„æ€§èƒ½æŒ‡æ ‡

## ğŸ”§ æŠ€æœ¯æ”¹è¿›å»ºè®®

### 1. å¼‚æ­¥ä»»åŠ¡ç³»ç»Ÿ

```python
# å»ºè®®å®ç°Celeryä»»åŠ¡é˜Ÿåˆ—
from celery import Celery

app = Celery('ztbai', broker='redis://localhost:6379')

@app.task
def process_bid_analysis(project_id: str, analysis_type: str):
    """å¼‚æ­¥å¤„ç†æ‹›æ ‡åˆ†æä»»åŠ¡"""
    # é•¿æ—¶é—´è¿è¡Œçš„åˆ†æä»»åŠ¡
    pass
```

**ä¼˜åŠ¿**:
- æ”¯æŒé•¿æ—¶é—´è¿è¡Œä»»åŠ¡
- ä»»åŠ¡çŠ¶æ€ç›‘æ§
- å¤±è´¥é‡è¯•æœºåˆ¶
- æ°´å¹³æ‰©å±•èƒ½åŠ›

### 2. æ–‡ä»¶æœåŠ¡å¢å¼º

```python
# æ–‡ä»¶ä¸‹è½½APIä¼˜åŒ–
@app.get("/api/files/download/{file_id}")
async def download_file(file_id: str, request: Request):
    """å¢å¼ºçš„æ–‡ä»¶ä¸‹è½½æœåŠ¡"""
    # æ”¯æŒæ–­ç‚¹ç»­ä¼ 
    # è®¿é—®æƒé™æ§åˆ¶
    # ä¸‹è½½ç»Ÿè®¡
    pass
```

**åŠŸèƒ½**:
- æ–­ç‚¹ç»­ä¼ æ”¯æŒ
- è®¿é—®æƒé™æ§åˆ¶
- ä¸‹è½½è¿›åº¦è·Ÿè¸ª
- æ–‡ä»¶å®Œæ•´æ€§éªŒè¯

### 3. é…ç½®ç®¡ç†ç³»ç»Ÿ

```python
# ç»Ÿä¸€é…ç½®ç®¡ç†
class ConfigManager:
    def __init__(self):
        self.configs = {}
    
    def get_agent_config(self, agent_type: str) -> Dict:
        """è·å–Agenté…ç½®"""
        pass
    
    def get_export_config(self, format_type: str) -> Dict:
        """è·å–å¯¼å‡ºé…ç½®"""
        pass
```

**ç‰¹æ€§**:
- ç¯å¢ƒéš”ç¦»é…ç½®
- çƒ­é‡è½½æ”¯æŒ
- é…ç½®ç‰ˆæœ¬ç®¡ç†
- å®‰å…¨é…ç½®åŠ å¯†

## ğŸ“Š æ€§èƒ½ä¼˜åŒ–æ–¹æ¡ˆ

### 1. æ•°æ®åº“ä¼˜åŒ–

```sql
-- æ·»åŠ å…³é”®ç´¢å¼•
CREATE INDEX idx_step_progress_project_step ON step_progress(project_id, step_key);
CREATE INDEX idx_projects_status ON projects(status);
CREATE INDEX idx_project_files_project_id ON project_files(project_id);
```

### 2. ç¼“å­˜ç­–ç•¥

```python
# Redisç¼“å­˜é›†æˆ
import redis

cache = redis.Redis(host='localhost', port=6379, db=0)

async def get_cached_analysis(project_id: str):
    """è·å–ç¼“å­˜çš„åˆ†æç»“æœ"""
    cached = cache.get(f"analysis:{project_id}")
    return json.loads(cached) if cached else None
```

### 3. å¹¶å‘å¤„ç†

```python
# å¹¶å‘å¤„ç†ä¼˜åŒ–
import asyncio
from concurrent.futures import ThreadPoolExecutor

executor = ThreadPoolExecutor(max_workers=4)

async def process_multiple_sections(sections: List[Dict]):
    """å¹¶å‘å¤„ç†å¤šä¸ªç« èŠ‚"""
    tasks = [process_section(section) for section in sections]
    return await asyncio.gather(*tasks)
```

## ğŸ›¡ï¸ å®‰å…¨å¢å¼ºå»ºè®®

### 1. æ–‡ä»¶å®‰å…¨

```python
# æ–‡ä»¶ç±»å‹éªŒè¯
ALLOWED_EXTENSIONS = {'.txt', '.doc', '.docx', '.pdf'}

def validate_file(file):
    """æ–‡ä»¶å®‰å…¨éªŒè¯"""
    # æ–‡ä»¶ç±»å‹æ£€æŸ¥
    # æ–‡ä»¶å¤§å°é™åˆ¶
    # ç—…æ¯’æ‰«æ
    pass
```

### 2. APIå®‰å…¨

```python
# APIé™æµå’Œè®¤è¯
from fastapi import Depends
from fastapi.security import HTTPBearer

security = HTTPBearer()

@app.middleware("http")
async def rate_limit_middleware(request: Request, call_next):
    """APIé™æµä¸­é—´ä»¶"""
    # å®ç°é™æµé€»è¾‘
    pass
```

## ğŸ“ˆ ç›‘æ§å’Œæ—¥å¿—

### 1. æ€§èƒ½ç›‘æ§

```python
# æ€§èƒ½æŒ‡æ ‡æ”¶é›†
from prometheus_client import Counter, Histogram

REQUEST_COUNT = Counter('ztbai_requests_total', 'Total requests')
REQUEST_DURATION = Histogram('ztbai_request_duration_seconds', 'Request duration')

@app.middleware("http")
async def metrics_middleware(request: Request, call_next):
    """æ€§èƒ½æŒ‡æ ‡ä¸­é—´ä»¶"""
    start_time = time.time()
    response = await call_next(request)
    REQUEST_DURATION.observe(time.time() - start_time)
    REQUEST_COUNT.inc()
    return response
```

### 2. ç»“æ„åŒ–æ—¥å¿—

```python
# ç»“æ„åŒ–æ—¥å¿—é…ç½®
import structlog

logger = structlog.get_logger()

async def log_step_progress(project_id: str, step: str, status: str):
    """è®°å½•æ­¥éª¤è¿›åº¦"""
    logger.info("step_progress",
                project_id=project_id,
                step=step,
                status=status,
                timestamp=datetime.now().isoformat())
```

## ğŸ”„ éƒ¨ç½²å’Œè¿ç»´

### 1. DockeråŒ–éƒ¨ç½²

```dockerfile
# Dockerfileç¤ºä¾‹
FROM python:3.11-slim

WORKDIR /app
COPY requirements.txt .
RUN pip install -r requirements.txt

COPY . .
EXPOSE 9958

CMD ["uvicorn", "new_api_server:app", "--host", "0.0.0.0", "--port", "9958"]
```

### 2. å¥åº·æ£€æŸ¥

```python
# å¢å¼ºå¥åº·æ£€æŸ¥
@app.get("/health/detailed")
async def detailed_health_check():
    """è¯¦ç»†å¥åº·æ£€æŸ¥"""
    return {
        "status": "healthy",
        "database": await check_database_health(),
        "ai_agents": await check_agents_health(),
        "file_system": await check_file_system_health(),
        "memory_usage": get_memory_usage(),
        "disk_usage": get_disk_usage()
    }
```

## ğŸ“‹ å®æ–½è·¯çº¿å›¾

### ç¬¬ä¸€é˜¶æ®µï¼ˆå·²å®Œæˆï¼‰
- âœ… æ­¥éª¤5-8çš„çœŸå®å®ç°
- âœ… ç«¯åˆ°ç«¯æµ‹è¯•è„šæœ¬
- âœ… åŸºç¡€æ¶æ„ä¼˜åŒ–

### ç¬¬äºŒé˜¶æ®µï¼ˆä¼˜å…ˆçº§é«˜ï¼‰
1. **å¼‚æ­¥ä»»åŠ¡ç³»ç»Ÿ**: é›†æˆCelery/RQ
2. **æ–‡ä»¶æœåŠ¡å¢å¼º**: æ–­ç‚¹ç»­ä¼ ã€æƒé™æ§åˆ¶
3. **ç¼“å­˜ç³»ç»Ÿ**: Redisé›†æˆ
4. **ç›‘æ§ç³»ç»Ÿ**: PrometheusæŒ‡æ ‡

### ç¬¬ä¸‰é˜¶æ®µï¼ˆä¼˜å…ˆçº§ä¸­ï¼‰
1. **å®‰å…¨å¢å¼º**: æ–‡ä»¶éªŒè¯ã€APIè®¤è¯
2. **æ€§èƒ½ä¼˜åŒ–**: æ•°æ®åº“ç´¢å¼•ã€å¹¶å‘å¤„ç†
3. **é…ç½®ç®¡ç†**: ç¯å¢ƒé…ç½®ã€çƒ­é‡è½½
4. **éƒ¨ç½²ä¼˜åŒ–**: DockeråŒ–ã€å¥åº·æ£€æŸ¥

### ç¬¬å››é˜¶æ®µï¼ˆä¼˜å…ˆçº§ä½ï¼‰
1. **é«˜çº§åŠŸèƒ½**: ç‰ˆæœ¬æ§åˆ¶ã€åä½œç¼–è¾‘
2. **AIå¢å¼º**: æ¨¡å‹ä¼˜åŒ–ã€æ™ºèƒ½æ¨è
3. **ç”¨æˆ·ä½“éªŒ**: ç•Œé¢ä¼˜åŒ–ã€äº¤äº’æ”¹è¿›
4. **æ‰©å±•èƒ½åŠ›**: æ’ä»¶ç³»ç»Ÿã€APIå¼€æ”¾

## ğŸ¯ å…³é”®æˆåŠŸæŒ‡æ ‡

### åŠŸèƒ½å®Œæ•´æ€§
- âœ… 8ä¸ªæ­¥éª¤100%å®ç°
- âœ… ç«¯åˆ°ç«¯æµç¨‹å¯ç”¨
- ğŸ”„ æ–‡ä»¶å¯¼å‡ºè´¨é‡
- ğŸ”„ AIç”Ÿæˆå‡†ç¡®æ€§

### æ€§èƒ½æŒ‡æ ‡
- APIå“åº”æ—¶é—´ < 200ms
- æ–‡ä»¶å¤„ç†æ—¶é—´ < 30s
- ç³»ç»Ÿå¯ç”¨æ€§ > 99%
- å¹¶å‘ç”¨æˆ·æ•° > 100

### ç”¨æˆ·ä½“éªŒ
- æ“ä½œæˆåŠŸç‡ > 95%
- é”™è¯¯æ¢å¤æ—¶é—´ < 5s
- å­¦ä¹ æˆæœ¬ < 30min
- ç”¨æˆ·æ»¡æ„åº¦ > 4.5/5

## ğŸ” æµ‹è¯•éªŒè¯

### 1. ç«¯åˆ°ç«¯æµ‹è¯•
- âœ… åˆ›å»ºäº†å®Œæ•´çš„E2Eæµ‹è¯•è„šæœ¬
- ğŸ”„ è¦†ç›–æ‰€æœ‰ä¸šåŠ¡æ­¥éª¤
- ğŸ”„ éªŒè¯æ–‡ä»¶ç”Ÿæˆè´¨é‡
- ğŸ”„ æ£€æŸ¥æ•°æ®ä¸€è‡´æ€§

### 2. æ€§èƒ½æµ‹è¯•
```bash
# å‹åŠ›æµ‹è¯•ç¤ºä¾‹
ab -n 1000 -c 10 http://localhost:9958/health
wrk -t12 -c400 -d30s http://localhost:9958/api/status
```

### 3. å®‰å…¨æµ‹è¯•
- æ–‡ä»¶ä¸Šä¼ å®‰å…¨æµ‹è¯•
- APIè®¿é—®æƒé™æµ‹è¯•
- æ•°æ®æ³¨å…¥é˜²æŠ¤æµ‹è¯•
- XSS/CSRFé˜²æŠ¤éªŒè¯

## ğŸ’¡ æœ€ä½³å®è·µå»ºè®®

### å¼€å‘è§„èŒƒ
1. **ä»£ç é£æ ¼**: éµå¾ªPEP8æ ‡å‡†
2. **é”™è¯¯å¤„ç†**: åˆ†å±‚å¼‚å¸¸å¤„ç†æœºåˆ¶
3. **æ—¥å¿—è®°å½•**: ç»“æ„åŒ–æ—¥å¿—è¾“å‡º
4. **æ–‡æ¡£ç»´æŠ¤**: APIæ–‡æ¡£è‡ªåŠ¨ç”Ÿæˆ

### è¿ç»´è§„èŒƒ
1. **ç‰ˆæœ¬ç®¡ç†**: è¯­ä¹‰åŒ–ç‰ˆæœ¬å·
2. **éƒ¨ç½²æµç¨‹**: CI/CDè‡ªåŠ¨åŒ–
3. **ç›‘æ§å‘Šè­¦**: å…³é”®æŒ‡æ ‡ç›‘æ§
4. **å¤‡ä»½ç­–ç•¥**: æ•°æ®å®šæœŸå¤‡ä»½

### å®‰å…¨è§„èŒƒ
1. **è®¿é—®æ§åˆ¶**: æœ€å°æƒé™åŸåˆ™
2. **æ•°æ®ä¿æŠ¤**: æ•æ„Ÿæ•°æ®åŠ å¯†
3. **å®¡è®¡æ—¥å¿—**: æ“ä½œè¡Œä¸ºè®°å½•
4. **æ¼æ´ç®¡ç†**: å®šæœŸå®‰å…¨æ‰«æ

## ğŸ“ æŠ€æœ¯æ”¯æŒ

### å¼€å‘å›¢é˜Ÿ
- **æ¶æ„å¸ˆ**: ç³»ç»Ÿè®¾è®¡å’ŒæŠ€æœ¯é€‰å‹
- **åç«¯å¼€å‘**: APIå®ç°å’Œä¸šåŠ¡é€»è¾‘
- **å‰ç«¯å¼€å‘**: ç”¨æˆ·ç•Œé¢å’Œäº¤äº’è®¾è®¡
- **AIå·¥ç¨‹å¸ˆ**: Agentå¼€å‘å’Œæ¨¡å‹ä¼˜åŒ–

### è¿ç»´å›¢é˜Ÿ
- **DevOps**: éƒ¨ç½²å’Œè¿ç»´è‡ªåŠ¨åŒ–
- **DBA**: æ•°æ®åº“ç®¡ç†å’Œä¼˜åŒ–
- **å®‰å…¨å·¥ç¨‹å¸ˆ**: å®‰å…¨ç­–ç•¥å’Œé˜²æŠ¤
- **ç›‘æ§è¿ç»´**: ç³»ç»Ÿç›‘æ§å’Œå‘Šè­¦

---

**æ–‡æ¡£ç‰ˆæœ¬**: v2.0  
**æœ€åæ›´æ–°**: 2024-08-30  
**ç»´æŠ¤è€…**: ZtbAiå¼€å‘å›¢é˜Ÿ  
**è”ç³»æ–¹å¼**: tech-support@ztbai.com